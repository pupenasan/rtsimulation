[9 <--- ](9.md) [   Зміст   ](README.md) [--> 9.2](9_2.md)

## 9.1. INTRODUCTION TO REAL-TIME SIMULATION

A simulation is a representation of the operation or features of a system through the use or operation of another system [1]. For the types of digital simulation discussed in this work, it is assumed that a simulation with discrete-time and constant-step duration is

**219**



**220**                             Real-Time Simulation Technologies

 

performed. During discrete-time simulation, time moves forward with constant-step duration in set slices or steps of equal duration. This is commonly known as fixed time-step simulation [2]. However, it is important to note that other solving techniques that are unsuitable for real-time simulation make use of variable time steps, which helps in solving high-frequency dynamics and nonlinear systems [3]. This subject is not covered in this chapter, but it is covered in Crosbie [4].

To solve mathematical functions and equations at a given time step, each variable or system state is solved successively as a function of variables and states at the end of the preceding time slice. For the sake of clarity, we do not consider iterative solver methods that are not time-bounded. In real-time simulation, explicit or semiexplicit solvers such as State-Space Nodal [5] are preferred for the fact that their computational time at each iteration is predictable. During a discrete-time simulation, the amount of physical time, or real time, it takes to compute all equations and functions representing a system during a given time slice can be shorter or longer than the duration of the simulation time-step. Figures 9.1a and b represent these two possibilities. In Figure 9.1a, the computing time is shorter than a fixed time step (also referred to as accelerated simulation), while in Figure 9.1b, the computing time is longer. These two situations are referred to as offline simulation. In both cases, the moment at which a result becomes available is irrelevant. In fact, when performing offline simulation, typically the objective is to obtain results as fast as possible. The time that a system takes to produce a simulation depends on the computation power available and the mathematical complexity of the system model.

Conversely, during real-time simulation, the accuracy of the computations depends not only on the precise dynamic representation of the system, but also on

 



 

Computation

*f* (*t*) Sim. clock

 

 

Computation

*f* (*t*) Sim. clock

 

 

Computation

*f* (*t*) Sim. clock





 

 

​               

***t\******n\*** – **1**                      ***t\******n\***

(a) O ine simulation: Faster then real time

 

 

 

​     

***t\******n\*** – **1**                      ***t\******n\***

(b) O ine simulation: Slower then real time

 

 

 

 

***t\******n\*** – **1**                      ***t\******n\***

(c)                        





 

 

***t\******n\*** **+ 1**

 

 

 

 

***t\******n\*** **+ 1**

 

 

 

 

***t\******n\*** **+ 1**





Time Time

 

 

​                                                                                              

​          ***f\*** **(*****tn\*** **+** **2****)**          

​          ***f\*** **(*****tn\*** **+** **1****)**          

​          ***f\*** **(*****tn\*****)**          





   

   

   

​       

   

   

​       

​          ***f\*** **(*****tn\*** **+** **1****)**          

​          ***f\*** **(*****tn\*****)**          



​                                                                                                               



​                                                                                                               



Time Time



 

 

​                                                    

​          ***f\*** **(*****tn\*** **+** **1****)**          

​          ***f\*** **(*****tn\*****)**          

   



Time Time





**FIGURE 9.1** Real-time simulation requisites and other simulation techniques.



Modern Methodology of Electric System Design                     **221**

 

the time duration necessary to produce results [6]. Figure 9.1c illustrates the chronological principle of a real-time simulation. For a real-time simulation to be valid, the real-time simulator that is used must accurately produce the internal variables and outputs of the simulation and do so within the same length of time that its physical counterpart would. In fact, the time required to compute the solution at a given time step must be shorter than the physical time duration of the time slice. This permits the real-time simulator to perform all operations necessary to make a real-time simulation relevant, including driving inputs and outputs (I/O) to and from externally connected devices. For a given time slice, any idle time following (or preceding) simulator operation is literally lost, as opposed to accelerated simulation, where this idle time is used to compute the equations at the next time step. In case of idle time, the real-time simulator waits until the clock ticks to the next time-step. However, if all simulator operations are not achieved within the required fixed time step, the real-time simulation is considered erroneous. Such an occurrence is commonly defined as an “overrun.”

Based on these basic definitions, it can be concluded that a real-time simulator is performing as expected if the equations and states of the simulated system are solved sufficiently accurately, that is, within a user specification, depending on the type of phenomena that the user wants to observe, with an acceptable resemblance to its physical counterpart and without the occurrence of overruns.

 

**9.1.1**           **T****iming** **and** **C****onsTrainTs**

As previously discussed, real-time digital simulation is based on discrete time steps, where the simulator solves model equations successively. Proper step size duration must be determined to accurately represent system frequency response up to the fastest transient of interest. Simulation results can be validated when the simulator achieves real-time performance without overruns.

For each time step, the simulator executes the same series of tasks: (1) read inputs and generate outputs, (2) solve model equations, (3) exchange results with other simulation nodes, and (4) wait for the start of the next step. A simplified explanation of this routine suggests that the state(s) of any externally connected device is sampled once at the beginning of each time step of the simulation. Consequently, the state(s) of the simulated system is communicated to external devices only once per time step. If not all the timing conditions of real-time simulation are met, overruns occur and discrepancies between the simulator results and the responsive of its physical counterpart are observed.

The inherent constraint of today’s real-time simulator is the inescapable use of a discrete-time-step solver, which can become a major limitation when simulating nonlinear systems, such as a High Voltage Direct Current (HVDC) electric power system [7], FACTS [8], active filters, or drives. When nonlinear events such as transistor switching are present in a real-time simulation, because of the nature of discrete-time-step solvers, numerical instability can occur. Different solving methods have been proposed to prevent this problem [6,9], but they cannot be used during real-time simulation.

Achieving real time is one thing, but achieving it synchronously is another. With nonlinear systems, there is no guarantee that switching events will occur (or should be simulated) at a discrete-time instance. Furthermore, multiple events can occur during a single time step, and without proper handling, the simulator may only be



**222**                             Real-Time Simulation Technologies

 

aware of the last one. Recently, real-time simulator manufacturers have proposed solutions to timing and stability problems. Proposed solutions generally known as discrete-time compensation techniques usually involve time-stamping and interpolation algorithms [8]. State-of-the-art real-time simulators take advantage of advanced I/O cards running at a sampling rate considerably faster than fixed-step simulation [10,11]. As the I/O card acquires data faster than the simulation, it can read state changes in between simulation steps. Then, at the beginning of the next time step, the I/O card passes on to the simulator not only state information, but also timing information regarding the moment at which the state change occurred. The simulator can then compensate for the timing error.

Figure 9.2 illustrates a classic case of simulation error caused by the late firing of a thyristor in a converter circuit. In this example, a thyristor is triggered at a

​                   

​             yristor            

​            iL             Inductor            

​            AC source            







 

 

 

 

 

 



 

1

0.8

0.6

0.4

​     ![Підпис: Voltage (V)](file:///C:/Users/OLEKSA~1/AppData/Local/Temp/msohtmlclip1/01/clip_image006.png)0.2

0

–0.2

–0.4

–0.6

–0.8





1

​               

​          Ts          

​          Time          

​          Jitter          

​          Jitter          

​          Time          

​          Amplitude variation          

​          Source     voltage     Thyristor     current (real     circuit)          

​          Thyristor current          

​          (uncompensated          

​          fixed-step simulation)          



0.8



0.6

0.4

​     ![Підпис: Current (mA)](file:///C:/Users/OLEKSA~1/AppData/Local/Temp/msohtmlclip1/01/clip_image008.png)0.2

0

–0.2

–0.4

–0.6

–0.8



–1 0         2         4         6         8         10       12 –1

Time (s)

**FIGURE 9.2** Timing problem in the simulation of a thyristor converter.



Modern Methodology of Electric System Design                     **223**

 

90-degree angle with respect to the AC voltage source positive zero-crossing. As soon as the thyristor is triggered, current starts flowing through it. The resulting load current obtained through uncompensated real-time simulation (dotted line) is represented with some degree of error in comparison to the current flowing through the physical circuit (plain black line). This is because the event at 90 electrical degrees does not occur synchronously to the simulator fixed time step. Thus, the thyristor gate signal is only taken into account at the beginning of the next time step. This phenomenon typically induces low-frequency spurious oscillations in the simulation, for example, causing “jitter” in the motor current [12]. When jitter occurs in a discrete-time simulation, subsynchronous or uncharacteristic harmonics (amplitude variations) may be visible in the resulting waveforms. In this case, variations are evident in the thyristor current.

Finally, the use of multiple simulation tools and different step sizes during real- time simulation can cause problems. When multiple tools are integrated in the same simulation environment, a method called co-simulation, data transfer between tools can present challenges since synchronization and data validity must be maintained [13]. Furthermore, in multirate simulations, where parts of a model are simulated at different rates (with different time-step durations), result accuracy and simulation stability are also issues [14]. For example, multirate simulation may be used to simulate a thermal system with slow dynamics along with an electrical system with fast dynamics [15]. The field of multirate simulation and co-simulation environments, where multiple tools are used side by side, is still an active topic of research.

 

**9.1.2**           **a****nalysis of** **s****imulaTor** **B****andwidTh** **r****equiremenTs**

The criteria that will dictate the capability, size, and consequently the cost of the simulator are (1) the frequency of the highest transients to be simulated, which in turn dictates minimum step size and (2) the size of the system to simulate (i.e., the number of differential/algebraic equation to compute), which along with the step size dictates the computing power required. The number of I/O channels required to interface the simulator with physical controllers or other hardware is also critically important, affecting the total performance and cost of the simulator.

[Figure 9.3 ](#_bookmark53)outlines the typical step size and computing power required for a variety of applications. On the left-hand side of the chart, it is observed that mechanical systems with slow dynamics will generally require a simulation time step between 1 and 10 ms, according to the rule of thumb that the simulation step size should be smaller than 5% to 10% of the smallest time constant of the system. A shorter step size may be required to maintain numerical stability in stiff systems. In addition, when friction

phenomena are present, simulation step sizes as low as 100–500 μs may be required.

It is a common practice with electromagnetic transient (EMT) simulators to use a simulation time step of 30–50 μs to provide acceptable results for transients up to 2 kHz [16]. Because greater precision can be achieved with smaller step sizes, simu-

lation of transient phenomena with frequency content up to 10 kHz typically require a simulation time step of approximately 10 μs.

Accurately simulating fast-switching power electronic devices requires the use of

very small time steps to solve system equations [12]. Offline simulation is widely used in



**224**                             Real-Time Simulation Technologies

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 



​            

​          Slow dynamics          

​          Slow and fast     dynamics and transients     Multiarea power system           Large power system          

​          Very fast transients          

​          Ultra fast transients          

​          Very large dyn. sim.     Multi UAVs and vehicles     Mechanical Systems Vehicles Robotics Aircrafts Fuel cells Batteries          

​          Medium-area power system     Small equivalent power systems controller testing          

​          multiconverters high-power drivers (1–10     MW)     Wind farms          

​          FACTS     ac     rs          

​          tive lte                             High-power drives     (1–5 MW) 1–3 kHz PWM     trains, o’ highway electric vehicles          

​          Interconnected mid-power drives     (100 kW)     10 kHz PWM     Very-low-power Low-power  drives (<10 kW) drives (100 kW) >10 kHz     PWM     10 kHz PWM  IGBT detailed hybrid vehicles    models          



​    

![Підпис: Computing power](file:///C:/Users/OLEKSA~1/AppData/Local/Temp/msohtmlclip1/01/clip_image010.png)1 kHz



1000 us



10 kHz

1000 us



20 kHz

50 us



40 kHz

25 us Simulation speed



100 kHz

10 us



250 kHz

5 us



1 MHz

1 us



**FIGURE 9.3** Simulation time step by application.

 

 

the field, but it is time consuming if no precision compromise has been made on models (i.e., by the use of average models) [17]. Power electronic converters with a higher pulse width modulation (PWM) carrier frequency in the range of 10 kHz, such as those used in low-power converters, require step sizes of less than 250 ns in duration without inter-

polation or 10 μs with an interpolation technique. AC circuits with higher resonance frequency and very short lines, as expected in low-voltage distribution circuits and electric rail power feeding systems, may require step sizes below 20 μs in duration. Tests that use practical system configurations and parameters are necessary to determine mini-

mum step size and computing power required to achieve the time step chosen.

Regardless of the simulator used, both numerical solver performance and the bandwidth of interest are considerations when selecting the appropriate step size. The standard approach for selecting a suitable fixed step size for models with increasing complexity is a time-domain comparison of waveforms for repeated runs with different step sizes.

**9.1.3**           **r****apid** **C****onTrol** **p****roToTyping**

Real-time simulators are typically used in three different application categories [18–21], as illustrated in [Figure 9.4](#_bookmark54). First, in rapid control prototyping (RCP) applications (Figure 9.4a), a plant controller is implemented using a real-time simulator and is connected to a real physical plant. RCP offers many advantages over implementing an actual controller prototype. A controller prototype developed using a real-time simulator is more flexible, less time consuming to implement, and easier to debug. The controller prototype can be tuned on the fly or completely modified with just a



Modern Methodology of Electric System Design                     **225**



   Controller

+–



Real plant



 

 

 

 

Real-time simulator

(a)

​                             

​            Controller            

​            Plant            

​            +–            







Real-time simulator          Real-time simulator (b)

 

​            

​          Controller          

​          Plant          

​          +–          

​          +     –          

​          Motor          











 

 

**FIGURE 9.4** Application categories.



Real-time simulator

(c)



 

few mouse clicks. Also, since every internal controller state is available, an RCP can be debugged faster without having to take its cover off.

 

**9.1.4**           **h****ardware****-****in****-****The****-****l****oop**

For hardware-in-the-loop (HIL), the second category of applications, a physical controller is connected to a virtual plant executed on a real-time simulator, instead of to a physical plant. Figure 9.4b illustrates a small variation to HIL. In this case, an implementation of a controller using RCP is connected to a virtual plant via HIL. In addition to the advantages of RCP, HIL allows for early testing of controllers when physical test benches are not available. Moreover, virtual plants usually cost less and have parameters that have less standard deviation of the parameters due to manufacturing process or caused by environmental variations. This allows for more repeatable



**226**                             Real-Time Simulation Technologies

 

results and provides for testing conditions that are unavailable on real hardware, such as extreme events testing in which a real device would be damaged for example.

 

**9.1.5**           **s****ofTware****-****in****-****The****-l****oop**

Software-in-the-loop (SIL) represents the third logical step beyond the combination of RCP and HIL. With a sufficiently powerful simulator, both controller and plant can be simulated in real time on the same simulator. SIL has the advantage over RCP and HIL that no I/O are used, thereby preserving signal integrity. Also, since both the controller and plant models run on the same simulator, timing with the outside world is no longer critical. The execution time can now be slower or faster than real time with no impact on the validity of the results. SIL can, therefore, be used for a class of simulation called accelerated simulation. In accelerated mode, a simulation runs faster than real time, allowing for a large number of tests to be performed in a short period of time. For this reason, SIL is well suited for statistical testing such as Monte Carlo simulations. SIL does not have to be done in real time because no physical device is connected to the process but because Monte Carlo simulations are very time consuming, involving typically several thousand simulation runs, a real-time simulator will result in shorter completion time than offline simulation; the simulation runs slower than real time.

[9 <--- ](9.md) [   Зміст   ](README.md) [--> 9.2](9_2.md)