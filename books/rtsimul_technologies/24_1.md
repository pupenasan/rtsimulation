[24 <--- ](24.md) [   Зміст   ](README.md) [--> 24.2](24_2.md)

## 24.1 INTRODUCTION

Simulation models of plant or actuator dynamics are utilized throughout the development cycle of new control systems. They can be used to validate the performance of a single controller in the presence of parameter variation or to investigate the behavior when the control loop is embedded within a larger system model. The models may be for desktop analysis or as part of a real-time test harness to validate the response of hardware components to simulated inputs. Whatever the application, efficient models are required whenever large numbers of simulations are to be carried out or where there are limits on the time available to update the model at each time step. To achieve this efficiency often requires that some simplifying assumptions must be made. This chapter aims to develop a systematic approach to developing models that maintain the inherent nonlinear behavior of a hydraulic circuit but that are based on a simplified representation of fluid dynamics.

Імітаційні моделі динаміки установки або приводу використовуються протягом усього циклу розробки нових систем керування. Вони можуть бути використані для перевірки продуктивності окремого контролера за наявності варіації параметрів або для дослідження поведінки, коли контур керування вбудований у більшу модель системи. Моделі можуть бути призначені для аналізу робочого столу або як частина тестової системи в реальному часі для перевірки відповіді апаратних компонентів на змодельовані вхідні дані. Яким би не було застосування, ефективні моделі потрібні щоразу, коли необхідно провести велику кількість симуляцій або коли існують обмеження на час, доступний для оновлення моделі на кожному кроці часу. Щоб досягти такої ефективності, часто потрібно зробити деякі спрощуючі припущення. Цей розділ спрямований на розробку систематичного підходу до розробки моделей, які зберігають притаманну нелінійну поведінку гідравлічного контуру, але які базуються на спрощеному представленні динаміки рідини.

### 24.1.1 Hydraulic Simulation Models

Individual hydraulic component models are traditionally built up from basic foundation blocks based on the dynamics of a volume of compressible fluid and the orifice equation. More complex system models can be developed either by connecting component models directly together or by using very small volumes of fluid as interface blocks at the junctions. These interface blocks may represent actual volumes of fluid or be artificial modeling artifacts used to connect self-contained subsystem models together. The benefits of this approach are that the model can be built up in a modular fashion and that the dynamics are described in terms of systems of ordinary differential equations (ODEs), for which there are numerous robust solvers available.

Індивідуальні моделі гідравлічних компонентів традиційно складаються з основних фундаментних блоків на основі динаміки об’єму рідини, що стискається, і рівняння діафрагми. Більш складні системні моделі можна розробити шляхом з’єднання моделей компонентів безпосередньо разом або використання дуже малих об’ємів рідини як інтерфейсних блоків на стиках. Ці інтерфейсні блоки можуть представляти фактичні об’єми рідини або бути штучними артефактами моделювання, які використовуються для з’єднання автономних моделей підсистем. Переваги цього підходу полягають у тому, що модель може бути побудована модульним способом і що динаміка описується в термінах систем звичайних диференціальних рівнянь (ОДУ), для яких є численні надійні розв’язувачі.

It is for this reason that many commercially available hydraulic simulation packages use this approach. The disadvantage is that small volumes of compressible fluid introduce very high-frequency dynamics into the model. These high-frequency modes require small time steps to be taken and hence results in longer simulation times. The problem can be partly alleviated by the use of “stiff” solvers if real-time code is not required. If real-time code is required, then one solution is to abstract the high-frequency dynamics by assuming that these small volumes of fluid are incompressible. It is shown in Ref. [1] that making this assumption leads to a model description in terms of differential algebraic equations (DAEs), that is, the model consists of a system of unconstrained dynamic equations, along with a number of algebraic constraints that the dynamic states must satisfy. 

Саме з цієї причини багато комерційно доступних пакетів гідравлічного моделювання використовують цей підхід. Недоліком є те, що невеликі об’єми стисливої рідини вносять у модель дуже високочастотну динаміку. Ці високочастотні режими вимагають невеликих кроків у часі, що призводить до довшого часу моделювання. Проблему можна частково вирішити за допомогою «жорстких» вирішувачів, якщо код реального часу не потрібен. Якщо потрібен код у реальному часі, то одним із рішень є абстрагування високочастотної динаміки, припускаючи, що ці малі об’єми рідини нестисливі. Це показано в Ref. [1], що таке припущення призводить до опису моделі в термінах диференціальних алгебраїчних рівнянь (DAE), тобто модель складається із системи необмежених динамічних рівнянь разом із низкою алгебраїчних обмежень, яким мають задовольняти динамічні стани.

### 24.1.2 Simulating Differential Algebraic Equations

Model descriptions in terms of DAEs arise in many applications, for example, in the simulation of electrical circuits, mechanical multibody dynamics, and chemical process models. An overview of current techniques used in the simulation of multibody dynamics is given in Ref. [2], which breaks down the approaches into three categories, namely Coupled-Force Balance, Lagrange, and Kane. The Coupled-Force Balance approach assumes that each body is free to move independently, and contact between bodies is maintained by applying external forces using stiff spring damper systems. This is analogous to connecting hydraulic components by small volumes of compressible fluid. The approach suffers from generating very stiff systems of ODEs, which, as previously discussed, can be difficult to simulate.

Опис моделі в термінах DAE виникає в багатьох програмах, наприклад, у моделюванні електричних кіл, механічної динаміки багатьох тіл і моделей хімічних процесів. Огляд сучасних методів, що використовуються для моделювання динаміки багатьох тіл, наведено в Ref. [2], який розбиває підходи на три категорії, а саме: Баланс зв’язаних сил, Лагранжа та Кейна. Підхід балансу зв’язаних сил припускає, що кожне тіло може вільно рухатися незалежно, а контакт між тілами підтримується шляхом застосування зовнішніх сил за допомогою систем жорстких пружинних амортизаторів. Це аналогічно з’єднанню гідравлічних компонентів невеликими об’ємами рідини, що стискається. Підхід страждає від створення дуже жорстких систем ODE, які, як обговорювалося раніше, може бути важко моделювати.

In the Lagrange approach, it is assumed that contact is defined by a system of algebraic constraints, which are adjoined to the unconstrained dynamic equations using what are termed “undetermined,” or Lagrange, multipliers. A simplified form of the equations used to describe the dynamics of constrained rigid bodies is given in Equation 24.1, where **v** is the state vector of velocities, **M** is a positive-definite mass matrix, and **F** are the external forces acting on the system. The state constraints are described by the system of linear equality constraints on the velocities (**W**), and the Lagrange multipliers **λ** then represent the internal constraint forces acting at the joints.

У підході Лагранжа передбачається, що контакт визначається системою алгебраїчних обмежень, які приєднуються до необмежених динамічних рівнянь за допомогою того, що називається «невизначеними», або множниками Лагранжа. Спрощену форму рівнянь, які використовуються для опису динаміки зв’язаних твердих тіл, наведено в рівнянні 24.1, де **v** — вектор стану швидкостей, **M** — позитивно визначена матриця мас, а ** F** – зовнішні сили, що діють на систему. Обмеження стану описуються системою лінійних обмежень рівності швидкостей (**W**), а множники Лагранжа **λ** представляють внутрішні сили обмеження, що діють на суглобах.

![image-20220823011625598](media/image-20220823011625598.png)

The Lagrange approach to simulating this type of DAE is to augment the dynamic equations with the derivatives of the constraints, as shown in Equation 24.2. This results in a system of equations where the number of states equals the number of states in the original unconstrained system, plus the number of constraints. There are a number of problems with simulating this system of equations. Firstly, the initial state values must be consistent, that is, they must be chosen so that they satisfy the constraints. Secondly, because the constraints have been differentiated, any drift from the constraint manifold during simulation must be controlled. Finally, if the constraints are functions of the position states, then they must be differentiated twice before they can be augmented with the unconstrained dynamic equations. These acceleration constraints can be unstable and hence require additional stabilization to produce a stable system of equations.

Підхід Лагранжа до моделювання цього типу DAE полягає в доповненні динамічних рівнянь похідними від обмежень, як показано в рівнянні 24.2. Це призводить до системи рівнянь, де кількість станів дорівнює кількості станів у вихідній системі без обмежень плюс кількість обмежень. Існує ряд проблем із моделюванням цієї системи рівнянь. По-перше, початкові значення стану повинні бути узгодженими, тобто вони повинні бути вибрані так, щоб вони задовольняли обмеженням. По-друге, оскільки обмеження були диференційовані, будь-який дрейф від різноманіття обмежень під час моделювання повинен контролюватися. Нарешті, якщо обмеження є функціями станів позиції, то їх потрібно двічі диференціювати, перш ніж їх можна буде доповнити необмеженими динамічними рівняннями. Ці обмеження прискорення можуть бути нестабільними і, отже, вимагають додаткової стабілізації для створення стабільної системи рівнянь.

![image-20220823011642865](media/image-20220823011642865.png)

The third approach to simulating multibody dynamic systems is based on the work of Kane [3], and a description of a practical simulator using this approach is given in Ref. [4]. The Kane method projects the unconstrained dynamic equations onto the constraint manifold, reducing the model to a minimal order system of ODEs, with a state vector equal in size to the number of unconstrained dynamic equations minus the number of constraints. The ability to generate a minimal order set of dynamic equations that can be simulated using standard ODE solvers makes the projection approach very appealing when simulating hydraulic models. There is one drawback, namely that a new set of minimal order ODEs must be derived whenever the number of constraints change. For example, the number of constraints will change in a hydraulic circuit model whenever a valve opens creating a new flow path or when a cylinder piston reaches its end-stop.

Третій підхід до моделювання багатотільних динамічних систем базується на роботі Кейна [3], а опис практичного симулятора, що використовує цей підхід, наведено в Ref. [4]. Метод Кейна проектує необмежені динамічні рівняння на багатоманітність обмежень, зводячи модель до системи мінімального порядку ОДУ з вектором стану, рівним за розміром кількості необмежених динамічних рівнянь мінус кількість обмежень. Можливість генерувати набір динамічних рівнянь мінімального порядку, який можна моделювати за допомогою стандартних розв’язувачів ODE, робить проекційний підхід дуже привабливим під час моделювання гідравлічних моделей. Існує один недолік, а саме те, що новий набір ODE мінімального порядку повинен бути отриманий щоразу, коли кількість обмежень змінюється. Наприклад, кількість обмежень змінюватиметься в моделі гідравлічного контуру кожного разу, коли відкривається клапан, створюючи новий шлях потоку, або коли поршень циліндра досягає свого кінцевого упору.

There are a number of approaches to handling systems with intermittent constraints. One method is to split the constraints into those that are always present and those that are likely to change. The projection approach can be used to reduce the number of equations based on the fixed number of constraints, and the remaining constraints can be implemented using the Lagrange approach as and when they become active.

Існує ряд підходів до роботи з системами з періодичними обмеженнями. Один із методів полягає в тому, щоб розділити обмеження на ті, які завжди присутні, і ті, які можуть змінюватися. Підхід проекції можна використовувати для зменшення кількості рівнянь на основі фіксованої кількості обмежень, а обмеження, що залишилися, можуть бути реалізовані за допомогою підходу Лагранжа, коли і коли вони стають активними.

This approach still suffers from the issues associated with the Lagrange approach. An alternative is to treat the system as a form of Hybrid System Model, whereby the model switches between systems of minimal order ODEs whenever the circuit topology changes. A discussion on the application of this approach to multibody system dynamics is given in Ref. [5], and an overview of a number of packages to support the simulation of this type of model is given in Ref. [6]. The decision that has to be made is whether to embed all possible sets of dynamic equations within the model before simulation or to derive new systems of equations online during the simulation. As the intent is to derive models that can run as efficiently as possible, a system by which all models are implemented before simulation is demonstrated in this chapter.

Цей підхід все ще страждає від проблем, пов’язаних з підходом Лагранжа. Альтернативою є трактування системи як форми моделі гібридної системи, за допомогою якої модель перемикається між системами ODE мінімального порядку щоразу, коли змінюється топологія схеми. Обговорення застосування цього підходу до динаміки багатотільних систем наведено в Ref. [5], а огляд ряду пакетів для підтримки моделювання цього типу моделі наведено в Ref. [6]. Рішення, яке необхідно прийняти, полягає в тому, чи вбудовувати всі можливі набори динамічних рівнянь у модель перед симуляцією, чи отримати нові системи рівнянь онлайн під час моделювання. Оскільки метою є отримання моделей, які можуть працювати якомога ефективніше, у цій главі демонструється система, за допомогою якої всі моделі реалізуються перед симуляцією.

### 24.1.3 Parameter Abstraction of Small Mass es

The mass matrix **M** is always assumed to be of full rank when using the constraint embedding techniques described in Refs. [1,4]. This means that the mass matrix of the reduced order equations will also have full rank and hence be invertible during the simulation. To fully specify the dynamics of a hydraulic circuit may require that some very small masses are introduced to act as connecting elements between larger objects, and these small masses can introduce high-frequency dynamics, leading to slow simulations, and potential instabilities. This chapter extends the work by Pfeiffer and Borchsenius [1] by introducing an approach that can simulate the resulting minimum order dynamic equations when the mass matrix is singular due to making these small masses to zero. 

Матриця мас **M** завжди передбачається повним рангом при використанні методів вбудовування обмежень, описаних у Refs. [1,4]. Це означає, що матриця мас рівнянь приведеного порядку також матиме повний ранг і, отже, буде оборотною під час моделювання. Щоб повністю визначити динаміку гідравлічного контуру, може знадобитися введення деяких дуже малих мас, які будуть сполучними елементами між більшими об’єктами, і ці малі маси можуть вводити високочастотну динаміку, що призводить до повільного моделювання та потенційної нестабільності. Цей розділ розширює роботу Пфайфера та Борхсеніуса [1], вводячи підхід, який може симулювати результуючі динамічні рівняння мінімального порядку, коли матриця мас є сингулярною через доведення цих малих мас до нуля.

### 24.1.4 Structure of Chapter

The remainder of the chapter is organized as follows. In Section 24.2, the DAEs are derived that describe the dynamics of a hydraulic system when the fluid in the pipes, cylinders, or orifices is assumed to be incompressible. The approach by which these DAEs are reduced to a minimal order system of ODEs is then outlined in Section 24.3. In Section 24.4, the method of simulating the minimal order ODEs when the mass matrix is singular is described. The approach is demonstrated in Section 24.5 using, as an example, a circuit consisting of a servo valve controlling the fluid pressure in a closed pipe. Finally, conclusions are presented in Section 24.6.

Решта розділу організована таким чином. У Розділі 24.2 виводяться DAE, які описують динаміку гідравлічної системи, коли рідина в трубах, циліндрах або отворах вважається нестисливою. Підхід, за допомогою якого ці DAE зводяться до системи мінімального порядку ODE, викладено в Розділі 24.3. У розділі 24.4 описано метод моделювання ОДУ мінімального порядку, коли матриця мас є сингулярною. Цей підхід продемонстровано в Розділі 24.5 на прикладі схеми, що складається з сервоклапана, що контролює тиск рідини в закритій трубі. Нарешті, висновки представлені в розділі 24.6.

[24 <--- ](24.md) [   Зміст   ](README.md) [--> 24.2](24_2.md)