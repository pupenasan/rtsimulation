[22.1 <--- ](22_1.md) [   Зміст   ](README.md) [--> 22.3](22_3.md)

## 22.2 MODELICA OVERVIEW

Modelica is a nonproprietary, object-oriented modeling language for multidomain physical systems. Models in Modelica are described by differential, algebraic, and discrete equations. Modelica has been used to model a wide variety of complex physical systems in the mechanical, electrical, thermal, hydraulic, pneumatic, and fluid domains with significant industrial application in the aerospace, automotive, and process industries. An extensive list of publications, including the full proceedings from all Modelica conferences, is available on the publication page of the Modelica website [2]. As a complement to modeling of acausal physical behavior, Modelica also supports modeling of systems with prescribed input/output (I/O) relationships (i.e., causal systems), such as control systems and hierarchical state machines. This section gives a brief overview of the Modelica language and its fundamental language features. 

Modelica — це непатентована об’єктно-орієнтована мова моделювання для багатодомних фізичних систем. Моделі в Modelica описуються диференціальними, алгебраїчними та дискретними рівняннями. Modelica використовувалася для моделювання різноманітних складних фізичних систем у механічних, електричних, теплових, гідравлічних, пневматичних і рідинних областях із значним промисловим застосуванням в аерокосмічній, автомобільній та переробній промисловості. Розширений список публікацій, включаючи повні матеріали всіх конференцій Modelica, доступний на сторінці публікацій веб-сайту Modelica [2]. Як доповнення до моделювання акаузальної фізичної поведінки, Modelica також підтримує моделювання систем із заданими взаємозв’язками вводу/виводу (тобто причинно-наслідкових систем), таких як системи керування та ієрархічні автомати. У цьому розділі подано короткий огляд мови Modelica та її основних мовних особливостей.

### 22.2.1 History

The Modelica language has evolved as a collaboration between computer scientists and engineers to provide a modeling language to describe the behavior of multidomain physical systems in an open format not tied to a particular tool. The roots of the Modelica language can be traced back to Hilding Elmqvist’s PhD thesis [3] in which he designed and implemented the Dymola modeling language. The Dymola language used an object-oriented, equation-based approach to formulate models of physical systems. Rather than forcing modelers to pose the problem using ordinary differential equations (ODEs) for which many solvers exist, the Dymola language allowed the problem to be posed as differential-algebraic equations (DAEs), which is generally considered a more natural way to describe physical problems [4]. Sophisticated symbolic algorithms were used in the language implementation to transform the mathematical model into a form capable of solution by existing numerical solvers. As symbolic algorithms advanced, in particular, the Pantelides algorithm [5] for DAE index reduction, it became possible to solve an even larger class of problems using the new approach pioneered by the Dymola language. Within the context of the ESPRIT project “Simulation in Europe Basic Research Working Group (SiE-WG),” Hilding Elmqvist in 1996 sought to bring together a group of object-oriented modeling language developers and engineering simulation experts in an attempt to develop a new modeling language to describe physical systems over a wide range of engineering domains. After a series of 19 meetings over the course of the next 3 years, version 1.3 of the Modelica language specification was released in December 1999.

Мова Modelica розвинулася в результаті співпраці між комп’ютерними науковцями та інженерами, щоб створити мову моделювання для опису поведінки багатодомних фізичних систем у відкритому форматі, не прив’язаному до конкретного інструменту. Коріння мови Modelica можна простежити до докторської дисертації Гілдінга Елмквіста [3], у якій він розробив і реалізував мову моделювання Dymola. Мова Dymola використовувала об’єктно-орієнтований підхід на основі рівнянь для формулювання моделей фізичних систем. Замість того, щоб змушувати модельєрів ставити проблему за допомогою звичайних диференціальних рівнянь (ОДВ), для яких існує багато розв’язників, мова Даймола дозволила поставити проблему у вигляді диференціально-алгебраїчних рівнянь (ДАЕ), що, як правило, вважається більш природним способом опису фізичних проблеми [4]. Складні символічні алгоритми були використані в мовній реалізації для перетворення математичної моделі у форму, придатну для вирішення за допомогою існуючих чисельних розв’язувачів. У міру розвитку символічних алгоритмів, зокрема алгоритму Пантелідеса [5] для зменшення індексу DAE, стало можливим розв’язувати ще більший клас проблем, використовуючи новий підхід, започаткований мовою Дімола. У контексті проекту ESPRIT «Робоча група з фундаментальних досліджень симуляції в Європі (SiE-WG)» Хілдінг Елмквіст у 1996 році намагався об’єднати групу розробників мови об’єктно-орієнтованого моделювання та експертів з інженерного моделювання для розробки нового мова моделювання для опису фізичних систем у широкому діапазоні інженерних областей. Після серії з 19 зустрічей протягом наступних 3 років у грудні 1999 року була випущена версія 1.3 специфікації мови Modelica.

The Modelica language specification is maintained by the Modelica Association, a nonprofit, nongovernmental organization established in 2000. The Modelica Association consists of individual and organizational members who actively participate in the design of the Modelica language. Since the initial release of the language specification, several major updates to the language have been released that incorporate additional language elements. The current version of the Modelica specification is version 3.2 [1]. The current and the previous versions of the Modelica specification are available on the Modelica website [6]. In addition to the Modelica language specification, the Modelica Association also develops and maintains the Modelica Standard Library (MSL), a large, free, multidomain library of Modelica models. The MSL serves as a common link between free and commercial library developers to promote compatibility between implementations. A listing of free and commercial libraries is available on the libraries page of the Modelica website [7]. For more history on the Modelica language, the interested reader is referred to the two published books on the language [8,9]. The most current information on the Modelica language can be found on the Modelica website at [www.modelica.org ](http://www.modelica.org/)[10]. 

Специфікація мови Modelica підтримується Асоціацією Modelica, некомерційною неурядовою організацією, заснованою в 2000 році. Асоціація Modelica складається з окремих і організаційних членів, які беруть активну участь у розробці мови Modelica. З моменту першого випуску специфікації мови було випущено кілька основних оновлень мови, які включають додаткові елементи мови. Поточна версія специфікації Modelica — версія 3.2 [1]. Поточна та попередня версії специфікації Modelica доступні на веб-сайті Modelica [6]. На додаток до специфікації мови Modelica, Асоціація Modelica також розробляє та підтримує стандартну бібліотеку Modelica (MSL), велику безкоштовну багатодоменну бібліотеку моделей Modelica. MSL служить спільною ланкою між розробниками безкоштовних і комерційних бібліотек для забезпечення сумісності між реалізаціями. Перелік безкоштовних і комерційних бібліотек доступний на сторінці бібліотек веб-сайту Modelica [7]. Щоб дізнатися більше про історію мови Modelica, зацікавлений читач може звернутися до двох опублікованих книг про мову [8,9]. Найновішу інформацію про мову Modelica можна знайти на веб-сайті Modelica за адресою [www.modelica.org ](http://www.modelica.org/)[10].

### 22.2.2 Modelica Example

To illustrate a few key features of the Modelica language, consider the example shown in Figure 22.2. This multiphysics model consists of a battery connected to a motor driving a load. The battery model includes the heat-generation effects of the dissipative resistance and the resulting degradation in voltage due to thermal effects. The thermal network model includes a lumped model of the battery thermal mass along with simple flow-based cooling through convection. A controller controls the battery cooling by monitoring the battery temperature and actuating the flow rate in the cooling system to achieve the desired battery temperature. This multidomain physical system model contains elements from the mechanical (rotational), electrical, and thermal domains. The model was constructed both from component models in the MSL and from models implemented by the authors.

Щоб проілюструвати кілька ключових особливостей мови Modelica, розглянемо приклад, показаний на малюнку 22.2. Ця мультифізична модель складається з батареї, з’єднаної з двигуном, що приводить в дію навантаження. Модель батареї включає ефекти генерації тепла через дисипативний опір і результуюче зниження напруги через термічні ефекти. Модель теплової мережі включає зосереджену модель теплової маси акумулятора разом із простим охолодженням на основі потоку через конвекцію. Контролер контролює охолодження батареї, контролюючи температуру батареї та керуючи швидкістю потоку в системі охолодження для досягнення бажаної температури батареї. Ця багатодомна модель фізичної системи містить елементи з механічної (обертальної), електричної та теплової областей. Модель була побудована як з компонентних моделей у MSL, так і з моделей, реалізованих авторами.

The Modelica source code for the example model is shown in [Figure 22.3](#_bookmark132). The Modelica source code completely describes the dynamics of the system, but a compiler is necessary to actually simulate the example. As will be described later in this chapter in more detail, the compiler flattens the equations in the Modelica source code and combines them into a causal set from which computer code can be generated for integration with existing numerical solvers.

Вихідний код Modelica для прикладу моделі показано на [Рис. 22.3] (#_bookmark132). Вихідний код Modelica повністю описує динаміку системи, але компілятор необхідний для фактичного моделювання прикладу. Як буде описано далі в цьому розділі більш детально, компілятор зводить рівняння у вихідний код Modelica та об’єднує їх у причинно-наслідковий набір, з якого можна створити комп’ютерний код для інтеграції з існуючими чисельними розв’язувачами.

![image-20220823005331734](media/image-20220823005331734.png)

**FIGURE 22.2** Modelica example model.

![image-20220823005344481](media/image-20220823005344481.png)

**FIGURE 22.3** Modelica code for example model.

To provide further understanding of the dynamics of the model, [Figure 22.4](#_bookmark133) shows simulation results as generated by the commercial tool Dymola* [11] (\* Dymola was used to generate all simulation results shown throughout this work though nearly any Modelica-compliant tool could have been used.). The load applied to the system is shown along with the resulting battery terminal voltage, battery temperature, and the controlled flow command for battery cooling. Note that the cooling system has a fixed cooling capacity that is insufficient to maintain the battery temperature under high-load conditions. Since the battery voltage is a function of the temperature, the desired load power is not met under all conditions. This example model will be used in Sections 22.3.4 and 22.3.5 to illustrate key concepts related to real-time modeling capability and model configuration.

Щоб забезпечити подальше розуміння динаміки моделі, [Малюнок 22.4](#_bookmark133) показує результати моделювання, згенеровані комерційним інструментом Dymola* [11] (\* Dymola використовувався для створення всіх результатів моделювання, показаних у цій роботі, хоча майже можна було використати будь-який інструмент, сумісний з Modelica.). Навантаження, прикладене до системи, відображається разом із кінцевою напругою на клемах акумулятора, температурою акумулятора та командою контрольованого потоку для охолодження акумулятора. Зауважте, що система охолодження має фіксовану потужність охолодження, якої недостатньо для підтримки температури акумулятора в умовах високого навантаження. Оскільки напруга акумулятора залежить від температури, бажана потужність навантаження не досягається за всіх умов. Цей приклад моделі буде використано в розділах 22.3.4 і 22.3.5 для ілюстрації ключових концепцій, пов’язаних із можливостями моделювання в реальному часі та конфігурацією моделі.

A key language feature in Modelica is the connector concept. Connectors are used to define the interfaces of the models. A unique connector is defined once for each physical domain. A connector definition primarily consists of two kinds of variables: a potential variable and a flow variable. These variables can also be described as “across and through” or “effort and flow” variables. Special semantics apply to connections made between connectors, and such connections result in equations between variables in the connectors. In a connection set, all matching potential variables are equated, and all matching flow variables are summed to zero at the connection point. Referring to the example model in [Figure 22.2](#_bookmark131), the rotational connectors are depicted as gray circles, the electrical connectors as blue squares, and the thermal connectors as red squares connected between the battery and the thermal network components. The definitions of the connectors from the MSL are shown in [Figure 22.5](#_bookmark134).

Ключовою особливістю мови в Modelica є концепція з’єднувача. З’єднувачі використовуються для визначення інтерфейсів моделей. Унікальний конектор визначається один раз для кожного фізичного домену. Визначення конектора в основному складається з двох типів змінних: потенційної змінної та змінної потоку. Ці змінні також можна описати як змінні «наскрізно» або «зусиль і потоку». Спеціальна семантика застосовується до зв’язків між сполучниками, і такі зв’язки призводять до рівнянь між змінними в сполучниках. У наборі з’єднань усі відповідні потенційні змінні прирівнюються, а всі відповідні змінні потоку підсумовуються до нуля в точці з’єднання. Посилаючись на приклад моделі на [Рис. 22.2] (#_bookmark131), ротаційні з’єднувачі зображені сірими кружками, електричні з’єднувачі – синіми квадратами, а термічні з’єднувачі – червоними квадратами, з’єднаними між батареєю та компонентами теплової мережі. Визначення з’єднувачів із MSL показано на [Рис. 22.5] (#_bookmark134).

![image-20220823005423740](media/image-20220823005423740.png)

**FIGURE 22.4** Sample simulation results from the motor battery example.

The connector concept is extremely powerful as it facilitates natural, acausal modeling of physical systems where connections between components in the Modelica model mimic connections seen in the physical world. As will be discussed in more detail, acausal models include no a priori assumptions about causality and allow quick and effortless model construction and reconfiguration. For example, a connection between rotational connectors is equivalent to a rigid connection (i.e., a kinematic constraint or an inertialess shaft) between physical elements. In the electrical domain, a connection between components is equivalent to a lossless wire connection (i.e., a perfect short). Just as physical systems are constructed through connections between hardware components, Modelica models are constructed through connections between equivalent virtual components. In this way, the virtual representation is consistent with system design schematics used by engineers.

Концепція з’єднувача є надзвичайно потужною, оскільки вона полегшує природне акаузальне моделювання фізичних систем, де зв’язки між компонентами в моделі Modelica імітують зв’язки, які можна побачити у фізичному світі. Як буде обговорюватися більш детально, акаузальні моделі не містять апріорних припущень про причинність і дозволяють швидко і без зусиль будувати та реконфігурувати моделі. Наприклад, з’єднання між обертовими з’єднувачами еквівалентне жорсткому з’єднанню (тобто кінематичне обмеження або безінерційний вал) між фізичними елементами. В електричній сфері з’єднання між компонентами еквівалентне з’єднанню дроту без втрат (тобто ідеальне замикання). Подібно до того, як фізичні системи будуються через з’єднання між апаратними компонентами, моделі Modelica будуються через з’єднання між еквівалентними віртуальними компонентами. Таким чином, віртуальне представлення узгоджується зі схемами проектування системи, які використовують інженери.

![image-20220823005455020](media/image-20220823005455020.png)

**FIGURE 22.5** Connector definitions.

Another key feature of the connector-based approach is the ability to seamlessly integrate models from various sources. The use of the standard connectors defined in the MSL ensures model compatibility between the MSL, user-implemented, free, and commercial libraries. Thus, Modelica with its open language specification is also an ideal model exchange format. As mentioned previously, the example model in [Figure 22.2 ](#_bookmark131)consists primarily of models from the MSL. At the top level of the model, the motor, damper, and inertia components are from the MSL. The thermal network, battery, load, and controller were primarily implemented as subsystems constructed from lower-level components of the MSL. The thermal network subsystem model is shown in [Figure 22.6](#_bookmark135). The only author-implemented model in the thermal network is the component that calculates the heat transfer coefficient for the convection element based on the cooling flow rate. With established multidomain connectors, model implementations using those connectors in the MSL, and other core language features to promote model reuse and configurability, the Modelica language provides a powerful platform for model-based systems engineering.

Іншою ключовою особливістю підходу на основі конектора є можливість плавно інтегрувати моделі з різних джерел. Використання стандартних з’єднувачів, визначених у MSL, забезпечує сумісність моделі між MSL, реалізованими користувачами, безкоштовними та комерційними бібліотеками. Таким чином, Modelica з її відкритою специфікацією мови також є ідеальним форматом обміну моделями. Як згадувалося раніше, приклад моделі на [Рисунок 22.2 ](#_bookmark131) складається переважно з моделей з MSL. На верхньому рівні моделі двигун, демпфер та інерційні компоненти виготовлені з MSL. Теплова мережа, батарея, навантаження та контролер були в основному реалізовані як підсистеми, побудовані з компонентів нижчого рівня MSL. Модель підсистеми теплової мережі показано на [Рисунок 22.6](#_bookmark135). Єдиною авторською реалізованою моделлю в тепловій мережі є компонент, який розраховує коефіцієнт тепловіддачі для конвекційного елемента за швидкістю потоку охолодження. Завдяки створеним багатодоменним з’єднувачам, реалізації моделі з використанням цих з’єднувачів у MSL та іншим основним функціям мови для сприяння повторному використанню моделі та можливості налаштування, мова Modelica забезпечує потужну платформу для системної інженерії на основі моделей.

![image-20220823005529829](media/image-20220823005529829.png)

**FIGURE 22.6** Thermal network subsystem from example model.

[22.1 <--- ](22_1.md) [   Зміст   ](README.md) [--> 22.3](22_3.md)