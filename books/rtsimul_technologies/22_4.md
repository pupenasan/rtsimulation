[22.3 <--- ](22_3.md) [   Зміст   ](README.md) [--> 22.5](22_5.md)

## 22.4 APPLICATION EXAMPLES

This section provides some examples of real-time applications from the Modelica literature. Since Section 22.3 mostly discussed features of the Modelica language to support real-time work, the intent of this section is to provide a flavor for selected published real-time applications of Modelica. These applications encompass many different model-based system development activities, including HiL, SiL, and controller V&V. It should be noted that many of these examples illustrate a workflow whereby the Modelica tool leverages third-party products such as MathWorks Real- Time Workshop® [36] to generate code and compile an executable for the target real-time platform.

У цьому розділі наведено кілька прикладів додатків у реальному часі з літератури Modelica. Оскільки в розділі 22.3 здебільшого обговорювалися функції мови Modelica для підтримки роботи в реальному часі, мета цього розділу полягає в тому, щоб надати перевагу вибраним опублікованим програмам Modelica в реальному часі. Ці додатки охоплюють багато різних видів діяльності з розробки систем на основі моделі, включаючи HiL, SiL і контролер V&V. Слід зазначити, що багато з цих прикладів ілюструють робочий процес, за допомогою якого інструмент Modelica використовує сторонні продукти, такі як MathWorks Real-Time Workshop® [36], для створення коду та компіляції виконуваного файлу для цільової платформи реального часу.

Otter et al. [37] demonstrated a very early application of Modelica and Dymola for real-time simulation of a detailed automatic gearbox. A model for the 4-speed automatic gearbox with a planetary and Ravigneaux gear set is developed in Modelica including the torque converter and the associated clutches to enable the various gears. The gearbox model is implemented with a simple drivetrain model to create a vehicle model. The paper described in detail several of the key Modelica models, including the implementation of the clutch model. Real-time simulation was performed using the code generated by Dymola, which was compiled using Real-Time Workshop and downloaded to a dSPACE platform for simulation. This early work demonstrated real-time capability from a Modelica model using Dymola’s symbolic manipulation for DAEs.

Видра та ін. [37] продемонстрували дуже раннє застосування Modelica та Dymola для моделювання в реальному часі детальної автоматичної коробки передач. Модель 4-швидкісної автоматичної коробки передач із планетарним набором передач і передач Ravigneaux розроблена в Modelica, включаючи гідротрансформатор і відповідні муфти для перемикання різних передач. Модель коробки передач реалізовано з простою моделлю трансмісії для створення моделі автомобіля. У документі детально описано кілька ключових моделей Modelica, включаючи реалізацію моделі зчеплення. Моделювання в режимі реального часу проводилося з використанням коду, створеного Dymola, який був скомпільований за допомогою Real-Time Workshop і завантажений на платформу dSPACE для моделювання. Ця рання робота продемонструвала можливість роботи в реальному часі з моделі Modelica з використанням символічної маніпуляції Dymola для DAE.

As a demonstration of the mixed-mode integration and inline integration schemes in Dymola for real-time simulation, Schiela and Olsson [32] tested the schemes on a 6-degree-of-freedom (DOF) robot example and a vehicle drivetrain example with a diesel engine and associated air path and loads. Benchmarking was performed using standard explicit and implicit integration schemes in addition to the mixed-mode and inline schemes in Dymola. Significant reduction in computational time was reported with the newly implemented techniques.

Як демонстрація схем інтеграції змішаного режиму та вбудованої інтеграції в Dymola для моделювання в реальному часі, Шила та Олссон [32] протестували схеми на прикладі робота з 6 ступенями свободи (DOF) і прикладі трансмісії автомобіля з дизельний двигун і пов'язаний з ним повітряний шлях і навантаження. Бенчмаркінг проводився з використанням стандартних явних і неявних схем інтеграції на додаток до змішаного режиму та вбудованих схем у Dymola. Повідомлялося про значне скорочення часу обчислення з нововпровадженими методами.

In one of the earliest industrial applications of Modelica for real-time simulation, Toyota [33] evaluated the newly introduced capabilities in Dymola for inline and mixed-mode integration. This work was part of a larger effort to use Modelica models to support HiL controller verification efforts. The authors evaluated inline and mixed-mode integration schemes for two industry application problems that included stiff behavior. The first problem was an engine example consisting of a mean value engine model with a complete air flow path with orifice-based flow calculations including a variable geometry turbo and an exhaust gas recirculation system. The second problem was a hydraulic actuator system with valves and long pipes. The problems were simulated on different HiL platforms with the different integration schemes for benchmarking. The authors note that the advanced integration techniques result in improved real-time performance for the stiff problems including up to two orders of magnitude reduction in computational time when compared with explicit methods.

В одному з найперших промислових застосувань Modelica для моделювання в реальному часі Toyota [33] оцінила нещодавно представлені можливості Dymola для вбудованої та змішаної інтеграції. Ця робота була частиною більших зусиль щодо використання моделей Modelica для підтримки перевірки контролера HiL. Автори оцінили вбудовані та змішані схеми інтеграції для двох галузевих прикладних проблем, які включали жорстку поведінку. Першою проблемою був приклад двигуна, який складався з моделі двигуна із середнім значенням із повним контуром повітряного потоку з обчисленням потоку на основі отворів, включаючи турбонаддув із змінною геометрією та систему рециркуляції вихлопних газів. Другою проблемою була система гідравлічного приводу з клапанами та довгими трубами. Проблеми були змодельовані на різних платформах HiL з різними схемами інтеграції для порівняльного аналізу. Автори відзначають, що передові методи інтеграції призводять до покращення продуктивності в реальному часі для жорстких проблем, включаючи до двох порядків зменшення часу обчислення порівняно з явними методами.

Elmqvist et al. [30,38] performed a detailed study of the modeling and real-time simulation issues associated with detailed vehicle powertrain and chassis models in Modelica. Common issues in automotive real-time simulations are described in the context of a gearbox example. The authors provide detailed information on the challenges, modeling approaches, and resulting real-time capability of a detailed automotive powertrain simulation. The authors demonstrated impressive real-time execution of a detailed vehicle dynamics model with 72 DOF on the Opal-RT platform using Dymola’s elaborate symbolic processing capabilities. Elmqvist et al. [30] provide insight into the symbolic and numerical processing capabilities of Dymola. Several different integration schemes are benchmarked and the results compared for both computational accuracy and efficiency. This work demonstrated that detailed automotive models in Modelica could be simulated in real time.

Елмквіст та ін. [30,38] провели детальне дослідження проблем моделювання та симуляції в реальному часі, пов’язаних із детальними моделями трансмісії автомобіля та шасі в Modelica. Поширені проблеми в автомобільному моделюванні в реальному часі описані в контексті прикладу коробки передач. Автори надають детальну інформацію про виклики, підходи до моделювання та кінцеву можливість детального моделювання силової установки автомобіля в режимі реального часу. Автори продемонстрували вражаюче виконання в режимі реального часу детальної моделі динаміки транспортного засобу з 72 DOF на платформі Opal-RT з використанням складних можливостей обробки символів Dymola. Елмквіст та ін. [30] дають уявлення про можливості Dymola для обробки символів і чисел. Кілька різних схем інтеграції перевіряються, а результати порівнюються щодо точності та ефективності обчислень. Ця робота продемонструвала, що детальні моделі автомобілів у Modelica можна симулювати в реальному часі.

Backman and Edvall [39] illustrated the use of a real-time dynamic process simulator for a pulp paper mill to support operator training for new equipment installs. Modelica models for the paper machines and processes were developed by integration of standard models of general equipment (valves, pumps, pipes, tanks, heat exchangers, etc.) with custom models of machinery specific to the paper plant. These reusable models were integrated with the actual control system and the actual operator displays to provide a simulation-based training environment that is identical to that of the actual physical plant. The models were compiled with Dymola into a Microsoft Windows application that is used as a real-time DDE server. This training environment helps to familiarize operators with new process dynamics, displays, and interlocking logic. Furthermore, it offers a safe environment for the simulation of a wide range of scenarios and disturbances, some potentially dangerous if performed in a physical sense, that affect the process conditions. In addition to training, the models can support control strategy development and verification before hardware deployment, resulting in significant reduction in test time.

Backman і Edvall [39] проілюстрували використання симулятора динамічного процесу в режимі реального часу для целюлозно-паперової фабрики для підтримки навчання операторів установці нового обладнання. Моделі Modelica для папероробних машин і процесів були розроблені шляхом інтеграції стандартних моделей загального обладнання (клапанів, насосів, труб, резервуарів, теплообмінників тощо) із спеціальними моделями машин, специфічних для паперового заводу. Ці багаторазові моделі були інтегровані з фактичною системою керування та реальними дисплеями оператора, щоб забезпечити середовище навчання на основі моделювання, яке є ідентичним до реального фізичного підприємства. Моделі були скомпільовані за допомогою Dymola в програму Microsoft Windows, яка використовується як сервер DDE у реальному часі. Це навчальне середовище допомагає операторам ознайомити з новою динамікою процесу, дисплеями та логікою взаємозв’язку. Крім того, він пропонує безпечне середовище для моделювання широкого діапазону сценаріїв і порушень, деякі з яких потенційно небезпечні, якщо вони виконуються у фізичному сенсі, які впливають на умови процесу. На додаток до навчання, моделі можуть підтримувати розробку стратегії керування та перевірку перед розгортанням апаратного забезпечення, що призводить до значного скорочення часу тестування.

Ferretti et al. [40] developed and implemented a concept to obtain real-time simulation code directly from Modelica models in an attempt to facilitate the use of existing Modelica models in real-time applications. The implementation involved the development of a special Modelica block that is used to define the I/O variables, communication with external tasks and hardware, and execution scheduling for the simulation. This module links to the Linux RTAI operating system and is capable of creating a soft real-time binary. Testing was performed on a 7-DOF multibody model for a robotic arm. While a promising approach, the resulting model was not real-time capable, and the authors recommended model refinement to simplify the computationally intensive dynamics, particularly nonlinear low-speed friction.

Ферретті та ін. [40] розробив і реалізував концепцію для отримання коду симуляції в реальному часі безпосередньо з моделей Modelica, намагаючись полегшити використання існуючих моделей Modelica в програмах реального часу. Реалізація передбачала розробку спеціального блоку Modelica, який використовується для визначення змінних вводу/виводу, зв’язку із зовнішніми завданнями та обладнанням, а також планування виконання для симуляції. Цей модуль пов’язаний з операційною системою Linux RTAI і здатний створювати програмний двійковий файл у реальному часі. Тестування проводилося на багатотільній моделі 7-DOF для роботизованої руки. Незважаючи на багатообіцяючий підхід, отримана модель не була здатною працювати в режимі реального часу, і автори рекомендували удосконалити модель, щоб спростити інтенсивну обчислювальну динаміку, зокрема нелінійне тертя на низькій швидкості.

Kellner et al. [41] developed techniques for the parameterization of Modelica models in HiL environments without file I/O operations. On the basis of a strong desire to separate models from parameters, The ZF Group stores model parameters in external ASCII files that are linked at initialization. This approach poses a challenge for systems such as dSPACE that do not allow file I/O operations. The authors developed a static and dynamic parameterization approach to link parameter files into the execution code. The approach was demonstrated with Dymola through a passenger car vehicle model that was simulated on a dSPACE platform.

Kellner та ін. [41] розробили методи параметризації моделей Modelica в середовищах HiL без операцій вводу/виводу файлів. На основі сильного бажання відокремити моделі від параметрів, ZF Group зберігає параметри моделі у зовнішніх файлах ASCII, які зв’язуються під час ініціалізації. Цей підхід створює проблеми для таких систем, як dSPACE, які не дозволяють операції введення/виведення файлів. Автори розробили статичний і динамічний підхід до параметризації для зв’язування файлів параметрів у коді виконання. Цей підхід було продемонстровано за допомогою Dymola на моделі транспортного засобу легкового автомобіля, змодельованого на платформі dSPACE.

Morawietz et al. [42] developed a Modelica model library consisting of powertrain and electrical system models in Modelica to support the development of control strategies for intelligent vehicle energy management and fuel consumption minimization. The paper describes in detail the thermodynamic model of the engine, the alternator model, and the implementation of a neural network library. A dynamic engine thermal model and associated thermal network including the oil and coolant is presented to model the impact of warm-up on engine thermodynamics and fuel consumption. A dynamic HiL environment based on dSPACE hardware was built to measure component parameters and test energy management strategies. The HiL setup allowed the interaction of the modeled engine and electrical system with alternator and battery hardware. Sample HiL results are shown for the battery voltage and various currents in the system in response to load changes.

Моравец та ін. [42] розробили бібліотеку моделей Modelica, що складається з моделей трансмісії та електричної системи в Modelica для підтримки розробки стратегій керування для інтелектуального керування енергією автомобіля та мінімізації споживання палива. У статті детально описано термодинамічну модель двигуна, модель генератора змінного струму та реалізацію бібліотеки нейронної мережі. Динамічна теплова модель двигуна та пов’язана теплова мережа, включаючи масло та охолоджуючу рідину, представлена для моделювання впливу прогріву на термодинаміку двигуна та споживання палива. Динамічне середовище HiL на основі обладнання dSPACE було створено для вимірювання параметрів компонентів і тестування стратегій управління енергією. Налаштування HiL дозволило взаємодіяти змодельований двигун та електричну систему з генератором змінного струму та обладнанням акумулятора. Показано зразки результатів HiL для напруги батареї та різних струмів у системі у відповідь на зміни навантаження.

Winkler and Gühmann [43] integrated a vehicle model in Modelica with a dynamic engine test bench to support model-based calibration of engine and transmission control units. Since the engine is represented in hardware, the vehicle model concentrates on the dynamics of the rest of the powertrain and vehicle. The Modelica models were created with Dymola and ultimately used with RT-LAB real-time software running on a standard PC. The authors also outline a detailed synchronization procedure to ensure appropriate communication interfaces and coupling between the dynamic test bench and the HiL vehicle simulation. The resulting integrated simulations allow measurement of fuel consumption and emissions from the actual engine hardware, values that are often difficult to predict analytically, over different drive cycles for a given vehicle model. The virtual vehicle model can easily be modified to represent different powertrain configurations, including both conventional and hybrid vehicles.

Вінклер і Гюман [43] інтегрували модель транспортного засобу в Modelica з динамічним випробувальним стендом двигуна для підтримки калібрування блоків керування двигуном і трансмісією на основі моделі. Оскільки двигун представлено апаратно, модель транспортного засобу зосереджена на динаміці решти трансмісії та автомобіля. Моделі Modelica були створені за допомогою Dymola і в кінцевому підсумку використовувалися з програмним забезпеченням реального часу RT-LAB, що працює на стандартному ПК. Автори також окреслюють детальну процедуру синхронізації для забезпечення відповідних інтерфейсів зв’язку та зв’язку між динамічним випробувальним стендом і симуляцією автомобіля HiL. Отримане інтегроване моделювання дозволяє вимірювати споживання палива та викиди від фактичного обладнання двигуна, значення, які часто важко передбачити аналітично, протягом різних циклів їзди для даної моделі автомобіля. Віртуальну модель автомобіля можна легко модифікувати для представлення різних конфігурацій трансмісії, включаючи як звичайні, так і гібридні транспортні засоби.

Ebner et al. [44] implemented an HiL solution for the development and testing of hybrid electric vehicle (HEV) components. The objective of this work is to allow testing and validation of virtual systems in conjunction with actual hardware components. The real-time system is a Suse Linux Enterprise Real-Time (SLERT) operating system. The Modelica Real-Time Interface, developed by Arsenal Research, provides the connection between Dymola for model simulation and the I/O interfaces for interaction with the hardware systems for real-time synchronization. It also permits execution of the HiL simulation directly from Dymola. Test cases for a HEV and an electric two-wheeler are presented. The HiL system included Modelica vehicle simulation models integrated with hardware battery and electrical systems as well as a dynamic test bench.

Ебнер та ін. [44] реалізували рішення HiL для розробки та тестування компонентів гібридних електромобілів (HEV). Мета цієї роботи полягає в тому, щоб дозволити тестування та валідацію віртуальних систем у поєднанні з фактичними апаратними компонентами. Система реального часу – це операційна система Suse Linux Enterprise Real-Time (SLERT). Інтерфейс реального часу Modelica, розроблений Arsenal Research, забезпечує зв’язок між Dymola для моделювання моделі та інтерфейсами вводу/виводу для взаємодії з апаратними системами для синхронізації в реальному часі. Це також дозволяє виконувати моделювання HiL безпосередньо з Dymola. Представлені тестові випадки для HEV та електричного двоколісного. Система HiL включала імітаційні моделі транспортних засобів Modelica, інтегровані з апаратною батареєю та електричними системами, а також стенд для динамічних випробувань.

Gäfvert et al. [45] implemented a Modelica-based solution for HiL simulation of dynamic liquid food processes. Modelica models for the liquid food processes were compiled using Dymola into a real-time process simulator running on a standard Windows PC and integrated with the production control strategy. This approach results in soft-real-time capability that is sufficient for the given application. The goal of this effort was to replace costly and time-consuming predelivery hardware testing using liquid surrogates with HiL testing using the process model. HiL simulation also offers opportunities for development, testing, and V&V of the production control strategy. A dairy pasteurization process was used to evaluate the real-time HiL platform. Testing with the HiL simulations over a range of fault conditions indicated that the model-based approach discovered nearly all problems identified with the hardware testing in addition to several others that were not discovered in hardware.

Gäfvert та ін. [45] реалізували рішення на основі Modelica для HiL моделювання динамічних рідких харчових процесів. Моделі Modelica для рідких харчових процесів були зібрані за допомогою Dymola в симулятор процесу в реальному часі, що працює на стандартному ПК з Windows та інтегрований зі стратегією управління виробництвом. Цей підхід призводить до можливостей м’якого реального часу, достатніх для даної програми. Мета цих зусиль полягала в тому, щоб замінити дороге та трудомістке тестування апаратного забезпечення переддоставки з використанням рідких сурогатів тестуванням HiL із використанням моделі процесу. Моделювання HiL також пропонує можливості для розробки, тестування та перевірки та перевірки стратегії управління виробництвом. Для оцінки платформи HiL у режимі реального часу використовувався процес пастеризації молочних продуктів. Тестування за допомогою моделювання HiL у ряді умов несправності показало, що підхід, заснований на моделі, виявив майже всі проблеми, виявлені під час тестування апаратного забезпечення, на додаток до кількох інших, які не були виявлені в апаратному забезпеченні.

Yuan and Xie [46] describe the modeling of a hydraulic steering system including the dynamic models of key components such as the priority valve and steering control unit. A Modelica model of the hydraulic steering system is then implemented in Dymola. The resulting model is used in a real-time simulation in conjunction with a vehicle model from Carsim to capture the interaction between the steering system and the vehicle dynamics through human-in-the-loop testing. Opal-RT RT-LAB is used as the real-time target. The resulting HiL setup allows various driving maneuvers to be simulated to verify the performance of the hydraulic steering system.

Yuan і Xie [46] описують моделювання гідравлічної системи рульового керування, включаючи динамічні моделі ключових компонентів, таких як пріоритетний клапан і блок керування рульовим керуванням. Потім у Dymola впроваджується модель гідравлічної системи рульового керування Modelica. Отримана модель використовується в симуляції в реальному часі разом із моделлю транспортного засобу від Carsim, щоб зафіксувати взаємодію між системою рульового керування та динамікою транспортного засобу за допомогою тестування за допомогою людини в циклі. Opal-RT RT-LAB використовується як ціль у реальному часі. Отримана настройка HiL дозволяє імітувати різні маневри водіння, щоб перевірити ефективність гідравлічної системи рульового керування.

Blochwitz and Beutlich [47] describe various steps for creating a real-time capable model from Modelica models in SimulationX [48]. Starting from a description of the key model, compiler, and solver optimizations required for real-time simulation, the authors describe the SimulationX Code Export Wizard that guides the user through the workflow to create real-time capable models in target-independent C code. The tool can interface with targets based on Simulink® [49] and Real-Time Workshop, dSPACE, SCALE-RT, and NI Veristand. Various model reduction and analysis techniques are described to aid the modeler in the nontrivial task of model complexity reduction for computational efficiency.

Blochwitz і Beutlich [47] описують різні кроки для створення моделі з можливістю роботи в реальному часі з моделей Modelica в SimulationX [48]. Починаючи з опису оптимізації ключової моделі, компілятора та вирішувача, необхідних для симуляції в реальному часі, автори описують майстер експорту коду SimulationX, який проводить користувача через робочий процес для створення моделей, здатних працювати в реальному часі, у незалежному від цілі коді на С. Інструмент може взаємодіяти з цілями на основі Simulink® [49] і Real-Time Workshop, dSPACE, SCALE-RT і NI Veristand. Описано різні методи зменшення та аналізу моделі, щоб допомогти розробнику моделей у нетривіальному завданні зменшення складності моделі для ефективності обчислень.

Bonvini et al. [50] demonstrated the use of Modelica for HiL simulation of a robot for control design. Although the application is simplified and largely academic in nature, the work is noteworthy for the open framework that it employed. Modelica is used to create a simplified model of a robot with two rotational DOF and also for creating the control algorithm. Through the open framework documented in the paper, a HiL system is shown with an Arduino microcontroller running the control algorithm from Modelica and a PC generating the desired trajectory, simulating the Modelica model of the robot, and visualizing the 3D movement. The open framework involves the use of OpenModelica for Modelica compilation and DAE generation through XML export, Java for generating executable code, and Python for visualization. This application, while academic in terms of scope and complexity, clearly showcases the unique possibilities with the open Modelica language in conjunction with other open-source tools.

Бонвіні та ін. [50] продемонстрували використання Modelica for HiL моделювання робота для проектування управління. Хоча додаток є спрощеним і значною мірою академічним за своєю природою, робота заслуговує на увагу через відкриту структуру, яку вона використовувала. Modelica використовується для створення спрощеної моделі робота з двома обертовими DOF, а також для створення алгоритму керування. Через відкриту структуру, задокументовану в статті, показано систему HiL з мікроконтролером Arduino, який виконує алгоритм керування з Modelica, і ПК, який генерує бажану траєкторію, імітуючи модель Modelica робота та візуалізуючи тривимірний рух. Відкрита структура передбачає використання OpenModelica для компіляції Modelica та генерації DAE через XML-експорт, Java для генерації виконуваного коду та Python для візуалізації. Хоча ця програма є академічною з точки зору обсягу та складності, чітко демонструє унікальні можливості відкритої мови Modelica в поєднанні з іншими інструментами з відкритим кодом.

Pitchaikani et al. [51] demonstrated a closed loop real-time simulation of a vehicle with a climate control system in Modelica. The climate control system model included the air and refrigerant loops with representations for the cabin, evaporator, expansion valve, condenser, compressor, blower, heater, and air inlet door. Real- time modeling of climate control systems is a challenge because of the complex, nonlinear physical phenomena inherent in the air and refrigerant loops and computationally expensive property calculations of the two media. The vehicle model was combined with a controller model in Simulink and simulated in an Opal-RT real- time environment. Drive cycle simulations with the integrated vehicle and controller model on the HiL platform were demonstrated in real time as part of a controller verification effort.

Пітчайкані та ін. [51] продемонстрували симуляцію в режимі реального часу замкнутого циклу транспортного засобу з системою клімат-контролю в Modelica. Модель системи клімат-контролю включала контури повітря та холодоагенту з представленнями кабіни, випарника, розширювального клапана, конденсатора, компресора, повітродувки, обігрівача та дверцят для впуску повітря. Моделювання систем клімат-контролю в режимі реального часу є складним завданням через складні нелінійні фізичні явища, притаманні контурам повітря та холодоагенту, а також обчислення властивостей двох середовищ, які потребують великих обчислень. Модель транспортного засобу було об’єднано з моделлю контролера в Simulink і змодельовано в середовищі реального часу Opal-RT. Симуляції циклу руху з інтегрованою моделлю транспортного засобу та контролера на платформі HiL були продемонстровані в режимі реального часу в рамках перевірки контролера.

[22.3 <--- ](22_3.md) [   Зміст   ](README.md) [--> 22.5](22_5.md)