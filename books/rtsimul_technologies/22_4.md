[22.3 <--- ](22_3.md) [   Зміст   ](README.md) [--> 22.5](22_5.md)

**22.1**            **APPLICATION EXAMPLES**

This section provides some examples of real-time applications from the Modelica literature. Since Section 22.3 mostly discussed features of the Modelica language to support real-time work, the intent of this section is to provide a flavor for selected published real-time applications of Modelica. These applications encompass many different model-based system development activities, including HiL, SiL, and con- troller V&V. It should be noted that many of these examples illustrate a workflow whereby the Modelica tool leverages third-party products such as MathWorks Real- Time Workshop® [36] to generate code and compile an executable for the target real-time platform.

Otter et al. [37] demonstrated a very early application of Modelica and Dymola for real-time simulation of a detailed automatic gearbox. A model for the 4-speed auto- matic gearbox with a planetary and Ravigneaux gear set is developed in Modelica including the torque converter and the associated clutches to enable the various gears. The gearbox model is implemented with a simple drivetrain model to create a vehicle model. The paper described in detail several of the key Modelica models, including the implementation of the clutch model. Real-time simulation was per- formed using the code generated by Dymola, which was compiled using Real-Time Workshop and downloaded to a dSPACE platform for simulation. This early work demonstrated real-time capability from a Modelica model using Dymola’s symbolic manipulation for DAEs.

As a demonstration of the mixed-mode integration and inline integration schemes in Dymola for real-time simulation, Schiela and Olsson [32] tested the schemes on a



Modelica as a Platform for Real-Time Simulation                      **573**

 

6-degree-of-freedom (DOF) robot example and a vehicle drivetrain example with a diesel engine and associated air path and loads. Benchmarking was performed using standard explicit and implicit integration schemes in addition to the mixed-mode and inline schemes in Dymola. Significant reduction in computational time was reported with the newly implemented techniques.

In one of the earliest industrial applications of Modelica for real-time simulation, Toyota [33] evaluated the newly introduced capabilities in Dymola for inline and mixed-mode integration. This work was part of a larger effort to use Modelica mod- els to support HiL controller verification efforts. The authors evaluated inline and mixed-mode integration schemes for two industry application problems that included stiff behavior. The first problem was an engine example consisting of a mean value engine model with a complete air flow path with orifice-based flow calculations including a variable geometry turbo and an exhaust gas recirculation system. The second problem was a hydraulic actuator system with valves and long pipes. The problems were simulated on different HiL platforms with the different integration schemes for benchmarking. The authors note that the advanced integration tech- niques result in improved real-time performance for the stiff problems including up to two orders of magnitude reduction in computational time when compared with explicit methods.

Elmqvist et al. [30,38] performed a detailed study of the modeling and real-time simulation issues associated with detailed vehicle powertrain and chassis models in Modelica. Common issues in automotive real-time simulations are described in the context of a gearbox example. The authors provide detailed information on the challenges, modeling approaches, and resulting real-time capability of a detailed automotive powertrain simulation. The authors demonstrated impressive real-time execution of a detailed vehicle dynamics model with 72 DOF on the Opal-RT plat- form using Dymola’s elaborate symbolic processing capabilities. Elmqvist et al. [30] provide insight into the symbolic and numerical processing capabilities of Dymola. Several different integration schemes are benchmarked and the results compared for both computational accuracy and efficiency. This work demonstrated that detailed automotive models in Modelica could be simulated in real time.

Backman and Edvall [39] illustrated the use of a real-time dynamic process simu- lator for a pulp paper mill to support operator training for new equipment installs. Modelica models for the paper machines and processes were developed by integra- tion of standard models of general equipment (valves, pumps, pipes, tanks, heat exchangers, etc.) with custom models of machinery specific to the paper plant. These reusable models were integrated with the actual control system and the actual opera- tor displays to provide a simulation-based training environment that is identical to that of the actual physical plant. The models were compiled with Dymola into a Microsoft Windows application that is used as a real-time DDE server. This training environment helps to familiarize operators with new process dynamics, displays, and interlocking logic. Furthermore, it offers a safe environment for the simulation of a wide range of scenarios and disturbances, some potentially dangerous if performed in a physical sense, that affect the process conditions. In addition to training, the models can support control strategy development and verification before hardware deployment, resulting in significant reduction in test time.



**574**                             Real-Time Simulation Technologies

 

Ferretti et al. [40] developed and implemented a concept to obtain real-time sim- ulation code directly from Modelica models in an attempt to facilitate the use of existing Modelica models in real-time applications. The implementation involved the development of a special Modelica block that is used to define the I/O variables, communication with external tasks and hardware, and execution scheduling for the simulation. This module links to the Linux RTAI operating system and is capable of creating a soft real-time binary. Testing was performed on a 7-DOF multibody model for a robotic arm. While a promising approach, the resulting model was not real-time capable, and the authors recommended model refinement to simplify the computa- tionally intensive dynamics, particularly nonlinear low-speed friction.

Kellner et al. [41] developed techniques for the parameterization of Modelica models in HiL environments without file I/O operations. On the basis of a strong desire to separate models from parameters, The ZF Group stores model parameters in external ASCII files that are linked at initialization. This approach poses a chal- lenge for systems such as dSPACE that do not allow file I/O operations. The authors developed a static and dynamic parameterization approach to link parameter files into the execution code. The approach was demonstrated with Dymola through a passenger car vehicle model that was simulated on a dSPACE platform.

Morawietz et al. [42] developed a Modelica model library consisting of power- train and electrical system models in Modelica to support the development of control strategies for intelligent vehicle energy management and fuel consumption minimi- zation. The paper describes in detail the thermodynamic model of the engine, the alternator model, and the implementation of a neural network library. A dynamic engine thermal model and associated thermal network including the oil and coolant is presented to model the impact of warm-up on engine thermodynamics and fuel consumption. A dynamic HiL environment based on dSPACE hardware was built to measure component parameters and test energy management strategies. The HiL setup allowed the interaction of the modeled engine and electrical system with alter- nator and battery hardware. Sample HiL results are shown for the battery voltage and various currents in the system in response to load changes.

Winkler and Gühmann [43] integrated a vehicle model in Modelica with a dynamic engine test bench to support model-based calibration of engine and trans- mission control units. Since the engine is represented in hardware, the vehicle model concentrates on the dynamics of the rest of the powertrain and vehicle. The Modelica models were created with Dymola and ultimately used with RT-LAB real-time soft- ware running on a standard PC. The authors also outline a detailed synchronization procedure to ensure appropriate communication interfaces and coupling between the dynamic test bench and the HiL vehicle simulation. The resulting integrated simula- tions allow measurement of fuel consumption and emissions from the actual engine hardware, values that are often difficult to predict analytically, over different drive cycles for a given vehicle model. The virtual vehicle model can easily be modified to represent different powertrain configurations, including both conventional and hybrid vehicles.

Ebner et al. [44] implemented an HiL solution for the development and test- ing of hybrid electric vehicle (HEV) components. The objective of this work is to allow testing and validation of virtual systems in conjunction with actual hardware



Modelica as a Platform for Real-Time Simulation                     **575**

 

components. The real-time system is a Suse Linux Enterprise Real-Time (SLERT) operating system. The Modelica Real-Time Interface, developed by Arsenal Research, provides the connection between Dymola for model simulation and the I/O interfaces for interaction with the hardware systems for real-time synchroniza- tion. It also permits execution of the HiL simulation directly from Dymola. Test cases for a HEV and an electric two-wheeler are presented. The HiL system included Modelica vehicle simulation models integrated with hardware battery and electrical systems as well as a dynamic test bench.

Gäfvert et al. [45] implemented a Modelica-based solution for HiL simulation of dynamic liquid food processes. Modelica models for the liquid food processes were compiled using Dymola into a real-time process simulator running on a standard Windows PC and integrated with the production control strategy. This approach results in soft-real-time capability that is sufficient for the given application. The goal of this effort was to replace costly and time-consuming predelivery hardware testing using liquid surrogates with HiL testing using the process model. HiL simu- lation also offers opportunities for development, testing, and V&V of the production control strategy. A dairy pasteurization process was used to evaluate the real-time HiL platform. Testing with the HiL simulations over a range of fault conditions indicated that the model-based approach discovered nearly all problems identified with the hardware testing in addition to several others that were not discovered in hardware.

Yuan and Xie [46] describe the modeling of a hydraulic steering system includ- ing the dynamic models of key components such as the priority valve and steering control unit. A Modelica model of the hydraulic steering system is then implemented in Dymola. The resulting model is used in a real-time simulation in conjunction with a vehicle model from Carsim to capture the interaction between the steering system and the vehicle dynamics through human-in-the-loop testing. Opal-RT RT-LAB is used as the real-time target. The resulting HiL setup allows various driving maneu- vers to be simulated to verify the performance of the hydraulic steering system.

Blochwitz and Beutlich [47] describe various steps for creating a real-time capa- ble model from Modelica models in SimulationX [48]. Starting from a description of the key model, compiler, and solver optimizations required for real-time simula- tion, the authors describe the SimulationX Code Export Wizard that guides the user through the workflow to create real-time capable models in target-independent C code. The tool can interface with targets based on Simulink® [49] and Real-Time Workshop, dSPACE, SCALE-RT, and NI Veristand. Various model reduction and analysis techniques are described to aid the modeler in the nontrivial task of model complexity reduction for computational efficiency.

Bonvini et al. [50] demonstrated the use of Modelica for HiL simulation of a robot for control design. Although the application is simplified and largely academic in nature, the work is noteworthy for the open framework that it employed. Modelica is used to create a simplified model of a robot with two rotational DOF and also for cre- ating the control algorithm. Through the open framework documented in the paper, a HiL system is shown with an Arduino microcontroller running the control algorithm from Modelica and a PC generating the desired trajectory, simulating the Modelica model of the robot, and visualizing the 3D movement. The open framework involves



**576**                             Real-Time Simulation Technologies

 

the use of OpenModelica for Modelica compilation and DAE generation through XML export, Java for generating executable code, and Python for visualization. This application, while academic in terms of scope and complexity, clearly showcases the unique possibilities with the open Modelica language in conjunction with other open-source tools.

Pitchaikani et al. [51] demonstrated a closed loop real-time simulation of a vehi- cle with a climate control system in Modelica. The climate control system model included the air and refrigerant loops with representations for the cabin, evaporator, expansion valve, condenser, compressor, blower, heater, and air inlet door. Real- time modeling of climate control systems is a challenge because of the complex, nonlinear physical phenomena inherent in the air and refrigerant loops and compu- tationally expensive property calculations of the two media. The vehicle model was combined with a controller model in Simulink and simulated in an Opal-RT real- time environment. Drive cycle simulations with the integrated vehicle and controller model on the HiL platform were demonstrated in real time as part of a controller verification effort.

[22.3 <--- ](22_3.md) [   Зміст   ](README.md) [--> 22.5](22_5.md)