[6.3 <--- ](6_3.md) [   Зміст   ](README.md) [--> 6.5](6_5.md)

## 6.4. TDL INTEGRATION WITH PTOLEMY II

Ptolemy II is the software infrastructure of the Ptolemy project [7], which studies modeling, simulation, and design of concurrent, real-time, and embedded systems. It is an open source tool written in Java that allows modeling and simulation of systems adhering to various models of computation (MoC). Conceptually, a MoC represents a set of rules, which govern the execution and interaction of model components.



Modeling and Simulation of Timing Behavior                        **173**

 

The implementation of a MoC is called a *domain* in Ptolemy. Some examples of existing domains are Discrete Event (DE), Continuous Time (CT), Finite State Machines (FSM), and Synchronous Data Flow (SDF).

Ptolemy is extensible in that it allows the implementation of new MoCs. Most MoCs in Ptolemy support actor-oriented modeling and design, where models are built from actors that can be executed and that can communicate with other actors through ports. The nature of communication between actors is defined by the enclos- ing domain, which is itself represented by a special actor, called the domain direc- tor. Simulating a model means executing actors as defined by the top-level model director.

 

**6.1.1**            **TDL D****omain**

TDL is implemented as an experimental domain in Ptolemy. The TDL domain consists of three specialized actors: *TDLModule*, *TDLMode*, and *TDLTask*. The TDLModule actor (with the associated *TDLModuleDirector*) restricts the basic modal model behavior according to the TDL semantics. In modal models, mode switches are made whenever a mode switch guard evaluates to true, whereas in TDL modules, mode switches are only allowed at predefined points in time. Similar restrictions apply to port updates. To ensure the LET of a task activation, input ports are only allowed to be read once, at the beginning of the LET, and output ports are only allowed to be written at the end of the LET and not when a task finished its computation. TDL requires a deterministic choice of one of all simultaneously enabled transitions, which is not provided by the FSM domain. We resolve this by employing a convention similar to the one supported by Stateflow [19], where the outgoing transitions of the active mode are tested based on the graphical layout, in clockwise order starting from the upper left corner of the graphical representation of the mode. TDL timing information such as the mode period is associated with TDL actors in the model.

TDL activities are conceptually regarded as DEs that are processed in increas- ing time stamp order. Thus, a TDL module can be seen as a restricted DE actor. This enables the usage of TDL modules inside every domain that is amenable to DE actors. A TDL task is implemented as an SDF actor, which executes in logically zero time. The top-level director is a DE director. The DE director uses a global event queue to schedule the execution of actors in the model. The TDL module places events in this queue for every time stamp where at least one TDL action is scheduled.

The module *Sender* from the example above modeled in Ptolemy is shown in [Figure 6.8](#_bookmark39). The model shown in the top-left box of the figure contains a TDL Module and two actors to provide sensor values and display actuator values. The TDL Module contains two modes *Main* and *Freeze* (see Figure 6.8, the bottom-left box). Both modes have their period indicated by an associated parameter. The *Main* mode contains the task and the association of sensor and actuator values to input and output ports of the task. The frequency of the task invocation, which determines the LET, is defined as a parameter.



**174**                                       Real-Time Simulation Technologies

​                                                                                           

​            DE director            

​            Sensor            

​            Sender            

​            TimedPlotter            

​            *s*1           *a*1            

​            SDF director            

​            Main            

​            *s*1            

​            *a*1            

​            *s*1            

​            *t*1            

​            *i*            

​            *i*            

​            o            

​            *a*1            

​            AddSubtract      +      –            

​            o            

​            Freeze            

​            1            

​            Period=5 milliseconds Period=1000 milliseconds            

​            Frequency=1            

​            Initial value=10            







**FIGURE 6.8** TDL module *Sender* in Ptolemy II.

 

Because of the iterative execution strategy of Ptolemy, problems with irresolv- able cyclic dependencies as described for the Simulink integration do not arise. As the LET is always greater than zero, there is an actor without a direct dependency between inputs and outputs. Consequently, the DE director is able to resolve the loop and to process the TDL actions represented as events in the correct order and poten- tially interleaved with the plant.

[6.3 <--- ](6_3.md) [   Зміст   ](README.md) [--> 6.5](6_5.md)

