[21.2 <--- ](21_2.md) [   Зміст   ](README.md) [--> 21.4](21_4.md)

## 21.3 USE OF AUTOSAR MODELS FOR SIMULATION AND ANALYSIS

Before going into the technical details on the use of AUTOSAR models for simulation and the discussion of the issues related to model-to-model transformations, it is important to recall what information is necessary for building an AUTOSAR model and at what stage in the development process an AUTOSAR description of the system should be available. In other words, is the AUTOSAR description the first and authoritative description of the system functions or is it produced later in the development based on some other models or outputs? Also, we should ask what could be the contribution of simulation performed on an AUTOSAR model to the understanding of the system dynamics. This question is relative to the possible advantages and outputs of a system-level simulation (or analysis of other types, including timing and reliability) performed on AUTOSAR models. That is, what can an AUTOSAR model tell us that cannot be obtained in another way?

Перш ніж перейти до технічних деталей щодо використання моделей AUTOSAR для моделювання та обговорення питань, пов’язаних із перетвореннями від моделі до моделі, важливо нагадати, яка інформація необхідна для створення моделі AUTOSAR і на якому етапі розробки має бути доступний опис системи AUTOSAR. Іншими словами, чи опис AUTOSAR є першим і авторитетним описом функцій системи, чи він створений пізніше в процесі розробки на основі деяких інших моделей чи результатів? Крім того, ми повинні запитати, яким може бути внесок моделювання, виконаного на моделі AUTOSAR, для розуміння динаміки системи. Це питання стосується можливих переваг і результатів моделювання на системному рівні (або аналізу інших типів, включаючи час і надійність), виконаного на моделях AUTOSAR. Тобто, що може сказати нам модель AUTOSAR, чого неможливо отримати іншим шляхом?

An initial short answer could be the following: given that AUTOSAR is fundamentally an empty container for functional behavior descriptions and given its limitations in the modeling of continuous-time systems, it is probably (as of now) not a realistic starting point for system-level modeling and analysis, but rather a valuable intermediate formalism that allows a better evaluation of the impact of the software design and coding and of the software–hardware execution platform on the performance of the controls and the other application functions.

Початкова коротка відповідь може бути наступною: враховуючи, що AUTOSAR є принципово порожнім контейнером для опису функціональної поведінки та враховуючи його обмеження в моделюванні систем безперервного часу, це, ймовірно (на даний момент), не є реалістичною відправною точкою для системних рівня моделювання та аналізу, а скоріше цінний проміжний формалізм, який дозволяє краще оцінити вплив дизайну програмного забезпечення та кодування та програмно-апаратної платформи виконання на продуктивність елементів керування та інших функцій програми.

### 21.3.1 Use of AUTOSAR in the Development Process

A possible use of the AUTOSAR formalism and tools in a development process is therefore the following:

•   The system functionality, including the system controls, are modeled in a suitable language (e.g., Simulink), together with the plant model, and validated by simulation with logical execution time assumptions. In case the controller (re)uses AUTOSAR SWCs, possibly imported in Simulink.

•   The execution platform for the system is selected and modeled in an AUTOSAR environment.

•   The functional model is translated into a corresponding AUTOSAR set of components, some functionality is possibly realized by reusing existing component models, and the virtual AUTOSAR model resulting from the composition is mapped onto the execution architecture according to the AUTOSAR process.

Отже, можливе використання формалізму та інструментів AUTOSAR у процесі розробки є таким:

• Функціональні можливості системи, включаючи елементи керування системою, моделюються відповідною мовою (наприклад, Simulink) разом із моделлю заводу та перевіряються за допомогою моделювання з логічними припущеннями про час виконання. Якщо контролер (повторно) використовує AUTOSAR SWC, можливо, імпортовані в Simulink.

• Платформа виконання для системи вибирається та моделюється в середовищі AUTOSAR.

• Функціональна модель транслюється у відповідний набір компонентів AUTOSAR, деякі функції, можливо, реалізуються шляхом повторного використання існуючих моделей компонентів, а віртуальна модель AUTOSAR, отримана в результаті композиції, відображається на архітектурі виконання відповідно до процесу AUTOSAR.

•   The result of the mapping stage, performed by the AUTOSAR tools, is the definition of the communication matrix, the task model, and the configuration of the RTE and BSW levels. This definition now allows the simulation of the system functions considering platform-related issues, including the simulation of not only the actual code implementing the application functions but also the code for the communication services and the basic services, with the operating system and the device drivers and the actual network message set.

Although other options are possible, this is a flow that exploits AUTOSAR strengths and attempts to overcome its limitations.

• Результатом етапу відображення, виконаного засобами AUTOSAR, є визначення комунікаційної матриці, моделі завдання та конфігурації рівнів RTE і BSW. Це визначення тепер дозволяє моделювати системні функції з урахуванням питань, пов’язаних з платформою, включаючи моделювання не лише фактичного коду, що реалізує функції програми, але й коду для служб зв’язку та основних служб, з операційною системою та драйверами пристроїв і фактичний набір мережевих повідомлень.

Хоча можливі й інші варіанти, це потік, який використовує сильні сторони AUTOSAR і намагається подолати його обмеження.

### 21.3.2 Simulation at the VFB (and Behavior) Level

This is the first option, the one commonly provided by commercial tools and possibly the one without clear advantages with respect to other competing methods since the peculiarity of an AUTOSAR model should be the availability of architecturespecific information, including the tasking and message model and the scheduling information. VFB-level simulation focuses on the higher level of the functional behavior of applications within the context of three layers of abstraction: the interface definition, the behavior definition, and the implementation definition.

Це перший варіант, який зазвичай надають комерційні інструменти і, можливо, не має явних переваг порівняно з іншими конкуруючими методами, оскільки особливістю моделі AUTOSAR має бути доступність інформації, що стосується архітектури, включаючи модель завдань і повідомлень, а також планування інформації. Моделювання на рівні VFB фокусується на вищому рівні функціональної поведінки додатків у контексті трьох рівнів абстракції: визначення інтерфейсу, визначення поведінки та визначення реалізації.

For the interface definition layer, the ports and the associated interfaces of a SWC communicating with other components and underlying BSW services are validated and verified. For the behavioral layer, runnables are validated and verified in terms of their execution semantics with respect to their triggering and activation sources. Since there is no model for the RTE and BSW, the events that are relevant for simulation are the set of (simulated) RTE periodic events and the Call and Write events on, respectively, Sender and Receiver ports.

Для рівня визначення інтерфейсу порти та пов’язані з ними інтерфейси SWC, які взаємодіють з іншими компонентами та базовими службами BSW, перевіряються. Для рівня поведінки запускові елементи перевіряються з точки зору семантики їх виконання щодо джерел запуску та активації. Оскільки немає моделі для RTE та BSW, події, які мають відношення до моделювання, це набір (змодельованих) періодичних подій RTE та подій виклику та запису відповідно на портах відправника та одержувача.

The implementation layer addresses the validation and verification of resource consumption. In particular, if this layer is fully defined, the time when events are generated can be inferred using the worst-case execution time attribute of each runnable. If this information is not available, the runnable execution is simulated to occur in zero logical time [13]. In a VFB-level simulation, the RTE is emulated on the selected simulation platform with its operating system, omitting details about the actual RTE implementation, the task model, and the execution platform. 

Рівень реалізації стосується перевірки та перевірки споживання ресурсів. Зокрема, якщо цей рівень повністю визначено, час генерації подій можна визначити за допомогою атрибута часу виконання в найгіршому випадку кожного виконуваного. Якщо ця інформація недоступна, імітується, що запущене виконання відбувається за нульовий логічний час [13]. У моделюванні на рівні VFB RTE емулюється на вибраній платформі моделювання з її операційною системою, пропускаючи подробиці про фактичну реалізацію RTE, модель завдання та платформу виконання.

### 21.3.3 Simulation at the RTE Level

The next level is the simulation of the system including the set of RTE calls and the RTE overheads. This requires availability of an RTE generator that provides the corresponding code. The simulation at the RTE level adds little to the previous step since it allows to verify the system functions with the *actual code* that performs the data communication over ports and the generation of events.

Наступним рівнем є моделювання системи, включаючи набір викликів RTE та накладні витрати RTE. Це вимагає наявності генератора RTE, який надає відповідний код. Моделювання на рівні RTE мало додає до попереднього кроку, оскільки воно дозволяє перевірити функції системи за допомогою *фактичного коду*, який виконує передачу даних через порти та генерацію подій.

### 21.3.4 Simulation at the BSW Level: From EC U-Level Simulation to Full Architecture Modeling

This final simulation level includes the possibility of modeling components at the BSW level, including the tasking model, the operating system, and the device drivers. Simulation at the BSW level can be performed not only at the ECU level but also at the system level, assuming availability of an architecture model, which allows the emulation of the ECUs and the network. Also, availability of the entire software stack at this point fully enables HIL simulation. This is indeed supported by the dSPACE development toolchain allowing ECU-level HIL simulation on the (micro) autobox platforms.

Цей останній рівень моделювання включає можливість моделювання компонентів на рівні BSW, включаючи модель завдань, операційну систему та драйвери пристроїв. Моделювання на рівні BSW може виконуватися не тільки на рівні ECU, але й на системному рівні, припускаючи наявність моделі архітектури, яка дозволяє емулювати ECU та мережу. Крім того, доступність усього стеку програмного забезпечення на даному етапі повністю дає змогу моделювати HIL. Це справді підтримується ланцюжком інструментів розробки dSPACE, що дозволяє симулювати HIL на рівні ECU на (мікро) платформах autobox.

For the timing evaluation at the ECU level with platform models, there is little support from commercial tools.

Для оцінки синхронізації на рівні ECU з моделями платформ комерційні інструменти мало підтримують.

An example of performance evaluation of AUTOSAR-based systems applied to a power window case study is described in Ref. [14], where an AUTOSAR application description is translated into a Discrete Event System Specification (DEVS) and then simulated using a DEVS engine. DEVS is a formalism for modeling discrete event systems in a hierarchical and modular way [15,16]. In Ref. [14], a DEVS model of the AUTOSAR BSW layers was used to simulate the real-time characteristics of the power window system. The execution times of all relevant actions were estimated by measurements on a MPC560xP microcontroller running at 64 MHz with an AUTOSAR BSW generated using Tresos AutoCore. The source code was compiled using the MULTI compiler of Green Hills Software. The measures included the execution time of all the runnables for any possible state (without the calls to the RTE); the execution time required for activating or suspending tasks and the context switch times; and the execution time of the writing and receiving of messages in every part of the communication stack including the RTE. The semantics of DEVS is indeed suited for matching the event model of AUTOSAR, and the simulation results were found to be a good match of the observed execution on the actual hardware target. The model included not only the AUTOSAR BSW but also a model of the controller area network (CAN) bus.

Приклад оцінки ефективності систем на базі AUTOSAR, застосованих до прикладу з електричним склопідйомником, описано в Ref. [14], де опис додатка AUTOSAR перекладається в специфікацію системи дискретних подій (DEVS), а потім імітується за допомогою механізму DEVS. DEVS — це формалізм для моделювання систем дискретних подій ієрархічним і модульним способом [15,16]. У посил. [14] модель DEVS шарів AUTOSAR BSW була використана для моделювання характеристик системи електричних вікон у реальному часі. Часи виконання всіх відповідних дій оцінювали за допомогою вимірювань на мікроконтролері MPC560xP, що працює на частоті 64 МГц із AUTOSAR BSW, згенерованим за допомогою Tresos AutoCore. Вихідний код було зібрано за допомогою компілятора MULTI від Green Hills Software. Заходи включали час виконання всіх виконуваних елементів для будь-якого можливого стану (без звернень до RTE); час виконання, необхідний для активації або призупинення завдань, і час перемикання контексту; і час виконання запису та отримання повідомлень у кожній частині комунікаційного стеку, включаючи RTE. Семантика DEVS справді підходить для відповідності моделі подій AUTOSAR, і було виявлено, що результати моделювання добре відповідають спостережуваному виконанню на фактичній апаратній цілі. Модель включала не лише AUTOSAR BSW, але й модель шини контролера мережі (CAN).

Another example of ECU-level modeling effort coupling the description of AUTOSAR SWCs with the BSW generation and an architecture model defined in SystemC is provided in Ref. [17]. As in the previously cited work, the objective is to evaluate the timing behavior of AUTOSAR components taking into account the underlying hardware and communication paths.

Інший приклад моделювання на рівні ECU, що поєднує опис AUTOSAR SWC з генерацією BSW і моделлю архітектури, визначеною в SystemC, наведено в Ref. [17]. Як і в цитованій раніше роботі, метою є оцінка тимчасової поведінки компонентів AUTOSAR з урахуванням основного апаратного забезпечення та шляхів зв’язку.

In Ref. [17], a formal correspondence was established between AUTOSAR modeling concepts and the corresponding SystemC design concepts [18] at different levels of abstraction (e.g., AUTOSAR runnables map onto SystemC processes). When considering the RTE and the BSW levels, the AUTOSAR design can be translated into a SystemC Programmer View where timing information is provided by timing annotations (in terms of execution cycles). Therefore, if the implementation software exists (e.g., after generation by the RTE generators and BSW configurators), the timing behavior of the software can be evaluated by cycle-level simulation on SystemC models of the hardware platform using the SystemC simulation engine [19].

У посил. [17] було встановлено формальну відповідність між концепціями моделювання AUTOSAR і відповідними концепціями проектування SystemC [18] на різних рівнях абстракції (наприклад, запускні елементи AUTOSAR відображаються на процеси SystemC). Розглядаючи рівні RTE та BSW, проект AUTOSAR можна перевести у представлення програміста SystemC, де інформація про час надається за допомогою анотацій часу (у термінах циклів виконання). Таким чином, якщо існує програмне забезпечення реалізації (наприклад, після генерації генераторами RTE та конфігураторами BSW), поведінку програмного забезпечення за часом можна оцінити моделюванням на рівні циклу на моделях апаратної платформи SystemC з використанням механізму моделювання SystemC [19] .

Additional research works [18,19] discuss simulation options for distributed platforms. In this case, of course, a model of the network adapter and the communication network must be provided. The case of CAN communication is discussed in the models in Ref. [14], and a FlexRay network model is part of the use case showing the applicability of the method proposed in Ref. [17].

Додаткові дослідницькі роботи [18,19] обговорюють варіанти моделювання для розподілених платформ. У цьому випадку, звичайно, необхідно надати модель мережевого адаптера і мережі зв'язку. Випадок зв'язку CAN обговорюється в моделях у Ref. [14], а модель мережі FlexRay є частиною варіанту використання, що демонструє застосовність методу, запропонованого в Ref. [17].

[21.2 <--- ](21_2.md) [   Зміст   ](README.md) [--> 21.4](21_4.md)