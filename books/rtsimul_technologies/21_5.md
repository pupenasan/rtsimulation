[21.4 <--- ](21_4.md) [   Зміст   ](README.md) [--> 21.6](21_6.md)

## 21.5 SIMULATION, TIMING ANALYSIS, AND CODE GENERATION: CONSISTENCY ISSUES AND MODEL ALIGNMENT

An AUTOSAR model has (at least) three different objectives: it can be used to simulate the functional behavior, it can be used to perform worst-case timing analysis using suitable tools and, of course, it is used to generate the code for the implementation of the model on a target platform. The same model should be used for the three purposes or at least very limited changes should be required to obtain the three different objectives of validation by timing analysis, simulation, and finally automatic implementation by code generation.

Модель AUTOSAR має (принаймні) три різні цілі: її можна використовувати для моделювання функціональної поведінки, її можна використовувати для виконання аналізу часу найгіршого випадку за допомогою відповідних інструментів і, звичайно, вона використовується для створення коду для реалізація моделі на цільовій платформі. Одна і та ж модель повинна використовуватися для трьох цілей або, принаймні, дуже обмежені зміни повинні бути потрібні для досягнення трьох різних цілей валідації шляхом аналізу часу, моделювання та, нарешті, автоматичної реалізації шляхом генерації коду.

To illustrate some of the issues, let us consider a fuel injection system. In this control application, several functions must be executed in response to events that correspond to a given rotation angle of the engine shaft. In practice, a crankshaft position sensor provides a reference hardware signal that is sporadic in nature and depends on the rotation speed of the shaft. This signal triggers a set of functions, typically mapped for execution onto a single task.

Щоб проілюструвати деякі проблеми, розглянемо систему впорскування палива. У цій програмі управління кілька функцій повинні виконуватися у відповідь на події, які відповідають заданому куту повороту валу двигуна. На практиці датчик положення колінчастого вала забезпечує еталонний апаратний сигнал, який має спорадичний характер і залежить від швидкості обертання вала. Цей сигнал запускає набір функцій, які зазвичай відображаються для виконання в одному завданні.

In AUTOSAR, a sporadic signal of this type cannot be directly defined as an RTE event. However, inside the application model, the runnables that are executed in response to the crankshaft position signal must be activated in response to an RTE event, given that this is the only legal way for a runnable to be activated in AUTOSAR.

У AUTOSAR спорадичний сигнал такого типу не можна безпосередньо визначити як подію RTE. Проте всередині прикладної моделі елементи запуску, які виконуються у відповідь на сигнал положення колінчастого вала, повинні бути активовані у відповідь на подію RTE, враховуючи, що це єдиний законний спосіб активації елемента запуску в AUTOSAR.

One possible solution is the following. A BSW runnable represents the interface between the hardware signal coming from the crankshaft position sensor and the application tasks. This BSW runnable writes into a sender/receiver port to forward to the application the sensor position signal. The SWCs containing application runnables that must be activated in response to this signal will define a matching port. Inside them, the runnables are then defined to be activated on the event of data received on the port.

Одним із можливих рішень є наступне. BSW runnable представляє інтерфейс між апаратним сигналом, що надходить від датчика положення колінчастого вала, і прикладними завданнями. Цей виконуваний BSW записує в порт відправника/одержувача, щоб переслати програмі сигнал положення датчика. SWC, що містять запуск програми, які мають бути активовані у відповідь на цей сигнал, визначатимуть відповідний порт. Усередині них визначаються запускні елементи, які активуються в разі надходження даних на порт.

The BSW component is the main variation point with respect to the three model versions. For simulation purposes, the BSW runnable is activated periodically by a counter/alarm pair. Inside, it contains the simulation stub that generates the stream of the crankshaft sensor signals. These signals are represented by writes into the sender/receiver port on which all the application-level runnables that must perform actions in correspondence to these events are waiting.

Компонент BSW є основною відмінністю щодо трьох версій моделі. Для цілей моделювання BSW runnable періодично активується парою лічильник/сигналізація. Всередині він містить заглушку моделювання, яка генерує потік сигналів датчика колінчастого валу. Ці сигнали представлені записами в порт відправника/одержувача, на якому очікують усі запускні елементи на рівні програми, які повинні виконувати дії відповідно до цих подій.

For code generation purposes, the BSW component is replaced by a device driver that will explicitly call the RTE API function for writing into the data port at the end of its execution.

Для цілей генерації коду компонент BSW замінено драйвером пристрою, який буде явно викликати функцію RTE API для запису в порт даних наприкінці її виконання.

Finally, for the purpose of worst-case timing analysis, it is necessary to have information about the worst-case arrival rate of the activation events for the sporadic task onto which all the runnables reacting to the crankshaft position sensor events are mapped. In AUTOSAR 4.0, this indication could come directly from a timed event triggering information ([Figure 21.8](#_bookmark128)). In past releases of the standard, a timing analysis tool would have to deduce the rate from the rate of the writes into the corresponding data port, which would require navigating the communication model graph to the BSW runnable and the corresponding alarm (which, however, can only be periodic since no AUTOSAR versions up to 3.2 allow sporadic activation events)

Нарешті, з метою аналізу часу найгіршого випадку необхідно мати інформацію про швидкість надходження подій активації в найгіршому випадку для спорадичного завдання, на яке відображаються всі робочі елементи, що реагують на події датчика положення колінчастого вала. У AUTOSAR 4.0 ця індикація може надходити безпосередньо з інформації про запуск події ([Малюнок 21.8](#_bookmark128)). У попередніх версіях стандарту інструмент аналізу часу повинен був виводити швидкість із швидкості запису у відповідний порт даних, що потребувало б переміщення графіка моделі зв’язку до виконуваного BSW та відповідного сигналу (який, проте, може бути лише періодичним, оскільки версії AUTOSAR до 3.2 не допускають спорадичних подій активації)

[21.4 <--- ](21_4.md) [   Зміст   ](README.md) [--> 21.6](21_6.md)