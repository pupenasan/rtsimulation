[1.4 <--- ](1_4.md) [   Зміст   ](README.md) [--> 1.6](1_6.md)

## 1.5. ГІБРИДНЕ ІМІТАЦІЙНЕ МОДЕЛЮВАННЯ В РЕАЛЬНОМУ ЧАСІ

Більшість імітаційних моделей у реальному часі характеризуються необхідністю включення певного фізичного компонента в імітаційну модель. Це може бути апаратне забезпечення в петлі, програмне забезпечення в петлі або людина (або люди) в петлі. У всіх випадках необхідно, щоб імітаційна модель була синхронізована з годинником реального часу, щоб забезпечити правильний час взаємодії між імітаційною моделлю та зовнішнім агентом.

### 1.5.1 Проблеми синхронізації в гібридному моделюванні в реальному часі

Виклики з якими стикаються потенційні користувачі гібридного моделювання повязані з виконанням в режимі реального. Вибір програмного забезпечення для підтримки розробки імітаційного моделювання може бути критичним, і його використання для належного представлення як неперервних, так і дискретних характеристик моделі та їх взаємодії вимагає особливої обережності. Важливе значення має точне керування часом, особливо точний обмін керуванням синхронізації між дискретними та безперервними процесами. На цьому етапі необхідно провести різницю між розміром кроку інтеграції та часом кадру (frame time) в імітаційній моделі в реальному часі. **Розмір кроку інтегрування (integration step size)** – це саме те як він називається, тобто приріст часу, на який поточний час просувається вперед за одне застосування вибраного алгоритму числового інтегрування. При моделюванні в реальному часі він зазвичай постійний. **Час кадру (frame time)** — це зазвичай постійний інтервал часу між передачею даних до зовнішніх елементів, таких як апаратне забезпечення в петлі або інша імітаційна модель. Кадр може складатися з кількох кроків часу інтеграції. У стандартній термінології CSSL в реальному часі його можна розглядати як еквівалент інтервалу зв’язку. Необхідний час кадру може диктувати вибір алгоритму інтеграції, особливо для високошвидкісних імітаційних моделей у реальному часі з потребою в дуже коротких кадрах.

У сукупності ці фактори становлять серйозний виклик для розробників гібридних імітаційних моделей у реальному часі. Зараз ми розглянемо деякі конкретні питання, які виникають при їх створенні.

Основна вимога до симуляції в реальному часі полягає в тому, що всі обчислення в кадрі повинні бути завершені протягом фіксованого часу кадру. У деяких програмах цю вимогу можна пом’якшити, дозволяючи випадкову втрату даних (можливо, спричинену затримками зв’язку, наприклад, із апаратним забезпеченням у птелі), але загалом потрібно дотримуватися вимог жорсткого реального часу.

Детальний характер гібридного моделювання в реальному часі певною мірою залежить від тривалості прийнятного часу кадру, який може варіюватися в різних типах застосувань від секунд до мікросекунд. Рідше проблемою для більш тривалого часу кадру є здатність процесора або процесорів виконувати необхідні обчислення за доступний час. Ключовою ж проблемою є синхронізація часу між різними частинами імітаційної моделі, особливо в тих випадках, коли моделювання розподілено між різними системами.

Розподілені імтаційні моделі реального часу часто включають різні компоненти програмного забезпечення, які потрібно інтегрувати в єдину імітаційну модель. Головним стає питання сумісності між програмними елементами. Для підтримки такого типу взаємодії було розроблено спеціальні програмні середовища. Однією з найбільш широко використовуваних є архітектура високого рівня (**HLA**, high-level architecture) [28]. Ця архітектура широко використовується, особливо у військових застосуваннях, де використовуються різні імітаційні моделі, що працюють на різних платформах у різних географічних місцях. Імітаційне моделювання HLA відоме як ***федерація (federation)***, а її компоненти — як ***федерати (federates)***. Дані, які передаються між різними федератами за допомогою техніки публікації та підписки, мають мітку часу, щоб забезпечити підтримку синхронізації часу за допомогою інтерфейсу реального часу.

Wainer, Kim та ін. [29,30] описали кілька цікавих гібридних імітаційних моделей реального часу на основі DEVS. Вони використовують інтерфейс, що підтримує комбінації компонентів моделі, які використовують різне програмне забезпечення на основі DEVS. Імітаційне моделювання робота, який долає перешкоди, використовує PowerDEVS для моделювання робота та ECD++ (інше програмне забезпечення на основі DEVS) для моделювання взаємодії з перешкодами.

Доступно кілька комерційних систем, які підтримують гібридне моделювання в реальному часі, включаючи:

- MathWorks xPC Target™ [31] 
- Real-Time Windows Target™ [32]
- поєднання National Instruments (NI) LabView з MathWorks Simulink за допомогою Simulation Interface Toolkit від NI [33], 
- RT-Lab від OPAL-RT [34], 
- середовище імітаційного моделювання rtX від Applied Dynamics International [35] 
- середовище імітаційного моделювання Real-Time Digital Simulator (RTDS), яке спеціально націлене на системи електроенергії, від RTDS Technologies [36].

### 1.5.2 Високошвидкісне гібридне моделювання в реальному часі

Особливі проблеми виникають із тими застосуваннями, які включають короткі інтервали між повторюваними дискретними подіями. Це стосується наприклад моделювання в реальному часі сучасних силових електронних систем. Електрична енергія може постачатися в багатьох різних формах. Найбільш очевидна різниця між змінним (змінним) і постійним (постійним) струмом. Хоча зазвичай використовуються частоти мережі 50 або 60 Гц для побутового постачання, можуть використовуватися і інші частоти. Наприклад, 400 Гц є загальним вибором для багатьох систем розподілу електроенергії, наприклад, у літаках. Вищі частоти потребують менших трансформаторів, фільтрів та іншого супутнього обладнання, але передбачають більші втрати на великих відстанях. Для багатьох частин обладнання (наприклад, комп’ютерів, телефонів, радіоприймачів, телевізорів) потрібне джерело живлення постійного струму, і зазвичай у мережевому шнурі є перетворювач зі змінного струму на постійний. Напруги постійного струму різняться для різних застосувань, і для живлення змінного та постійного струму існують різні обмеження на кількість допустимих гармонійних спотворень (небажані частоти змінного струму).

Перетворювачі перетворюють електроенергію в обидві сторони між змінним і постійним струмом. Перетворювачі передбачають значну кількість перемикань незалежно від того, виробляють вони сигнал постійного струму з форми змінного струму чи навпаки. Перемиканням часто керують регулятори широтно-імпульсної модуляції, які змінюють інтервали між подіями перемикання, зберігаючи середню частоту постійною. У сучасних перетворювачах частоти перемикання встановлюються якомога вищими, щоб мінімізувати гармонійні спотворення та обмежити розмір пов’язаних компонентів. Для застосувань з більшою потужністю (наприклад, система живлення для електричних суден) частоти перемикання можуть бути в діапазоні кілогерц. Для невеликих приладів частоти можуть вимірюватися десятками або навіть сотнями кілогерц. Для частоти перемикання 10 кГц середній інтервал між подіями перемикання становить 100 мкс. У моделюванні не в реальному часі для мінімізації помилок у синхронізації події перемикання ймовірно, буде використаний алгоритм інтеграції зі змінними кроками з виявленням розривів. У моделюванні в реальному часі з використанням алгоритму інтеграції з фіксованими кроками похибки синхронізації мінімізуються завдяки використанню достатньо коротких кроків. Якщо, наприклад, максимально допустима похибка синхронізації становить 2% від середнього періоду форми хвилі перемикання контролера, то розмір кроку не повинен перевищувати 2 мкс. Найгірший випадок виникає, коли фактичний час перемикання настає відразу після закінчення кроку. У цьому випадку етап інтегрування буде проходити з використанням рівнянь, які були дійсними до події перемикання для всього кроку, і відповідна змодельована подія перемикання не відбудеться до кінця кроку. У цьому випадку похибка синхронізації дорівнює довжині кроку інтегрування. Методи, спрямовані на компенсацію помилок синхронізації перемикання в моделюванні в реальному часі, обговорюються в розділі 1.5.3.

Зауважте, що імітаційне моделювання в реальному часі, які потребують часу кадру менше ніж 10–20 мкс, вимагають спеціальних систем обробки, оскільки звичайні системи імітаційного моделювання в реальному часі не здатні надійно підтримувати такі короткі кадри. Для цієї мети використовувалися цифрові сигнальні процесори (**DSP** Digital signal processors) [37] і програмовані вентильні матриці (**FPGA** field-programmable gate arrays) [38]. DSP або FPGA не обов’язково повинні бути потужнішими (у сенсі MFLOPS), ніж звичайна система. Ключовим є те, що процесор, який виконує критичний код моделювання, не вразливий до переривання операційною системою. Виділене ядро або ядра в багатоядерному процесорі також можуть бути використані таким чином. Середовище імітаційного моделювання енергосистеми RTDS використовує як DSP, так і процесори на основі FPGA і пропонує високошвидкісні блоки, здатні витримувати час кадру 2 мкс.

### 1.5.3 Чисельне інтегрування для високошвидкісного моделювання в реальному часі

Методи вирішення потреби в коротких кадрах у високошвидкісному моделюванні в реальному часі (**HSRT** high-speed real-time) можна розділити на:

- використання простих алгоритмів, які мінімізують обсяг обчислень, 
- і використання методів, які компенсують події перемикання на проміжному кроці.

Як обговорювалося раніше, найпростіший алгоритм інтегрування забезпечується методом Ейлера. Щоб отримати оцінку зміни значення кожної змінної протягом кроку він птребує лише, щоб похідні змінних системи на початку кроку (усі вони відомі) помножилися на фіксовану довжину кроку. Ця проста екстраполяція має перевагу простоти. Загалом він не використовується широко в безперервному моделюванні через більші похибки відсікання, але у випадках, коли розмір кроку обмежений з інших причин, він може бути ефективним. Однак це викликає занепокоєння щодо стабільності. Інтеграція Ейлера є найпростішим із класу однокрокових методів різного порядку, відомих як методи Рунге–Кутта, які дають наближення до середньої швидкості зміни змінної стану протягом кроку. Запаси стабільності для алгоритмів інтеграції, як правило, можна виразити через власні значення системи (які можна розглядати як такі, що приблизно відповідають оберненим постійним часу). Інтеграція Ейлера стає нестійкою, якщо розмір кроку перевищує вдвічі найкоротшу постійну часу (точніше 2/λ, де λ - є найбільшим власним значенням). Така ситуація може виникнути в момент, коли трохи коротші (стабільні) кроки дають прийнятно точні результати, тому перехід від прийнятних до абсолютно непридатних результатів може бути негайним. Для нелінійних систем з власними значеннями, які можуть змінюватися від кроку до кроку, це може бути серйозною проблемою. Отже, користувачам доцільно бути повністю обізнаними про динаміку своїх систем і про потенціал чисельної нестабільності. Методи Рунге–Кутта вищого порядку мають дещо покращену поведінку стабільності, але запас, як і раніше, загалом не перевищує приблизно 2,8/λ (поліпшення лише приблизно на 40% порівняно з методом Ейлера). Одна з переваг використання алгоритмів із змінним кроком полягає в тому, що вони зазвичай гарантують, що довжина кроку залишається в стабільній області, але їх використання зазвичай не є варіантом моделювання в реальному часі.

Іншим варіантом моделювання в реальному часі є явний багатокроковий метод фіксованої довжини, такий як метод Адамса–Бешфорта ([Wiki](https://uk.wikipedia.org/wiki/Метод_Адамса)). Цей підхід відстоював Роберт М. Хоу [39], який має довгу історію інноваційного внеску в методологію моделювання в реальному часі. Хоу також розробив методи спеціально для комутованих лінійних ланцюгів. Вони зустрічаються зокрема в застосуваннях силової електроніки, які компенсують той факт, що моменти комутації відбуваються під час кроку [40]. Підхід Хоу передбачає поділ кроку на підкроки, розділені перемиканням подій, і обчислення аналітичних розв’язків диференціальних рівнянь з використанням попередньо обчислених коефіцієнтів. Ці методи вимагають додаткових обчислень, але також можуть значно зменшити похибки. Вони дозволяють використовувати довші кроки для такої ж точності за ціною більшого обчислення на крок, і вони представляють серйозний варіант для моделювання HSRT із використанням моделей лінійних диференціальних рівнянь.

Де Келпер та ін. [41] також розробив методи мінімізації ефекту похибок перемикання при моделюванні електроенергетичних систем у реальному часі, які адаптують методи інтеграції змінного кроку не в реальному часі, описані в розділі 1.4.2, до методів фіксованого кроку, зокрема для застосувань реального часу. Де Келпер двома способами адаптував метод до імітаційного моделювання з фіксованими кроками в реальному часі. Перший полягає в тому, щоб обмежити інтерполяцію одним лінійним процесом, а другий полягає в тому, щоб просунути рішення від точки перемикання на ту саму фіксовану довжину кроку, але знову використати лінійну інтерполяцію для отримання рішення в кінці вихідного кроку. Іншими словами, перший крок йде від *t* до *t* + *h* і інтерполюється для пошуку рішення в *t* + *d*, тобто час, коли лінійна інтерполяція означує місце перемикання. Другий крок йде від *t* + *d* до *t* + *d* + *h*, і лінійна інтерполяція використовується для отримання рішення при *t* + *h*. Беднар і Кросбі [42] розробили ефективний метод інтеграції для лінійних моделей, який базується на підході переходу між станами [43]. Підхід із переходами станів базується на розв’язанні векторного диференціального рівняння

![image-20220817230747947](media/image-20220817230747947.png) 

Припускаючи вибірку та утримання введення,

![image-20220817230802506](media/image-20220817230802506.png) 

то наближений розв'язок є

![image-20220817230823219](media/image-20220817230823219.png)

де Φ – матриця переходу.

Цей підхід забезпечує клас явних методів із фіксованим кроком різної складності та точності залежно від того, скільки членів двох нескінченних рядів використовується. Виявилася ефективною версія відома як метод **ST(3,2)** з використанням трьох і двох термів відповідно. У ряді тестів вона була вигіднішою порівняно з іншими методами щодо точності, стабільності та часу обчислення. Метод також можна застосувати до деяких нелінійних систем рівнянь [44].

### 1.5.4 Багатошвидкісне моделювання HSRT

Більшість застосувань, які вимагають моделювання HSRT, включають компоненти з нижчою динамікою пропускної здатності, які не вимагають короткого часу кадру, який розроблено для надання методів HSRT. У цих випадках краще розробити багатошвидкісне моделювання, у якому система розділена на сегменти, які моделюються з використанням різних частот кадрів. Це означає, що ті сегменти, які не залежать від техніки HSRT, можуть бути реалізовані на звичайних процесорах. Для підтримки високошвидкісних багатошвидкісних імітаційних моделей у режимі реального часу було розроблено багатошвидкісний тест (benchmark ).

Багатошвидкісне моделювання було визнаною технікою моделювання протягом багатьох років (наприклад, Ref. [45]). Його часто використовували для прискорення виконання великих імітаційних моделей. Основна ідея полягає в тому, що немає необхідності оновлювати динаміку повільніших частин системи з тією ж швидкістю, що потрібна для швидших частин. Це проста ідея, яка витримала випробування часом, якщо застосовувати її обережно та консервативно. Вона особливо підходить для застосунків HSRT, для яких можна виконувати високошвидкісні сегменти на спеціальних високошвидкісних процесорах і повільніші сегменти на більш звичайних комп’ютерних системах.

Однак і тут є проблеми. Розміри кроків для різних сегментів слід вибирати ретельно. Також необхідно розрізняти розмір кроку інтеграції та інтервал зв’язку. Сегменти багатошвидкісного моделювання взаємодіють один з одним через інтервали зв’язку, які зазвичай пов’язані цілими кратними. У межах інтервалу зв’язку імітаційна модель може виконуватися в продовж одного кроку інтеграції, що дорівнює за довжиною інтервалу зв’язку, або за допомогою кількох кроків інтеграції, які разом просувають моделювання на тривалість одного інтервалу зв’язку. Ці кроки інтеграції можуть мати фіксовану або змінну довжину за умови, що підтримується синхронність із інтервалом зв’язку.

Багатошвидкісне моделювання фактично є системою вибіркових даних, і можуть виникнути проблеми з адекватністю даних, що передаються між сегментами, особливо коли швидшому сегменту доводиться чекати кілька інтервалів зв’язку, перш ніж він отримає оновлення від повільнішого сегмента. Вхідні дані від повільного сегмента можна підтримувати постійними між оновленнями (утримання нульового порядку), але це вводить ефективну часову затримку, що становить приблизно половину повільнішого часу кадру. Для компенсації можна використовувати методи екстраполяції (утримання першого, другого чи навіть дробового порядку). Інше питання полягає в тому, як дані передаються від швидшого до повільнішого сегмента, враховуючи, що швидший сегмент створюватиме кілька точок даних між передачею даних до повільнішого. Потрібен певний метод усереднення швидких виходів для кожного повільного кадру. Існує небезпека ефекту накладення, якщо швидко мінливі результати швидкого сегмента не фільтруються або не усереднюються якимось чином. У деяких випадках цього можна досягти шляхом ретельного вибору меж сегмента, щоб вихідні сигнали швидкого сегмента не мали високочастотних компонентів. В інших випадках може знадобитися додати фільтри згладжування. Якщо не приділити достатньої уваги інтервалам зв’язку та процесам обміну даними, багатошвидкісне моделювання може стати неточним або навіть нестабільним.

Багатошвидкісне порівняльне(benchmark) моделювання, засноване на моделюванні безпілотного підводного апарату (UUV), було розроблено у співпраці з Університетом Південної Кароліни та Університетом Глазго [46,47]. UUV використовує акумуляторну батарею як джерело енергії, що живить привід двигуна змінного струму через перетворювач постійного струму в змінний. Привід забезпечує живлення судна, яке моделюється як платформа з шістьма ступенями свободи з поверхнями управління. Система розділена на підсистеми, які імітуються з різною частотою кадрів: (1) перетворювач і комутаційний контролер (швидкий), (2) контролер зворотного зв’язку (повільний середній), (3) моторний привід (швидкий середній) і (4) судно, батарея та графіка інтерфейсу (повільно). Система UUV проілюстрована на рис. 1.5. Типова частота кадрів моделювання, яка використовується в цьому моделюванні

- Battery, ship, 3D graphics: 100 mS Converter, 
- switch controller: 2–5 μS 
- Motor: 50–100 μS
- Feedback controller: 1 mS


![image-20220817230944092](media/image-20220817230944092.png)

**Рис. 1.5** Спрощене представлення моделі безпілотного підводного апарату (входи та виходи судна та елементи керування опущені).

Імітаційне моделювання було реалізовано за допомогою Virtual Test Bed (VTB), розробленого Університетом Південної Кароліни [48] як у версіях не в реальному часі, так і в режимі реального часу. Як ознака підвищення швидкості завдяки використанню багатошвидкісних методів, реалізації цієї імітаційної моделі в системі Microsoft Windows, яка працює не в режимі реального часу, показали прискорення на три порядки порівняно з версіями, які використовували найшвидшу швидкість для всієї системи, без істотних змін у точності результатів. VTB забезпечує гнучке середовище моделювання з двовимірною та тривимірною графікою для виводу та керування користувачем. Він підтримує мультидисциплінарне моделювання як з механічними, так і з електричними компонентами та має бібліотеку, що містить широкий спектр електричних і механічних компонентів.

Версія реального часу замінила систему приводу UUV (двигун і приводний вал силової установки) апаратним забезпеченням. Було неможливо відтворити фактичні фізичні компоненти в лабораторії, тому для представлення фактичного двигуна використовувався невеликий малопотужний двигун. Навантаження на приводний вал представляв генератор, з'єднаний з вихідним валом двигуна. Вихід генератора був підключений до програмованого резистивного навантаження, яке керувалося імітаційною моделлю. Ця конфігурація підтримувала еквівалентне моделювання в реальному часі системи UUV, яка могла підтримувати розробку високошвидкісних методів багатошвидкісного моделювання в режимі реального часу.

[1.4 <--- ](1_4.md) [   Зміст   ](README.md) [--> 1.6](1_6.md)

